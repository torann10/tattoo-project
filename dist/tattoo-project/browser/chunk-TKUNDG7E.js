import{b as yc,d as wc,e as Gn,f as Ks,g as vc,h as Ic,j as js,k as st,l as Tc,m as Ft,n as Ec,o as Ac,p as Sc,q as Rc,r as Pc,t as $s}from"./chunk-U4PAU4FA.js";import{e as Gs,f as p}from"./chunk-CQCHLVVT.js";var qf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bt={},T,go=go||{},V=qf||self;function di(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function rr(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function Uf(n){return Object.prototype.hasOwnProperty.call(n,Qs)&&n[Qs]||(n[Qs]=++Bf)}var Qs="closure_uid_"+(1e9*Math.random()>>>0),Bf=0;function zf(n,t,e){return n.call.apply(n.bind,arguments)}function Gf(n,t,e){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(t,i)}}return function(){return n.apply(t,arguments)}}function pt(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?pt=zf:pt=Gf,pt.apply(null,arguments)}function Zr(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var r=e.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ct(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[i].apply(r,o)}}function ie(){this.s=this.s,this.o=this.o}var Kf=0;ie.prototype.s=!1;ie.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Kf!=0)&&Uf(this)};ie.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Uc=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function po(n){let t=n.length;if(0<t){let e=Array(t);for(let r=0;r<t;r++)e[r]=n[r];return e}return[]}function Vc(n,t){for(let e=1;e<arguments.length;e++){let r=arguments[e];if(di(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function _t(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}_t.prototype.h=function(){this.defaultPrevented=!0};var jf=function(){if(!V.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let e=()=>{};V.addEventListener("test",e,t),V.removeEventListener("test",e,t)}catch{}return n}();function Hn(n){return/^[\s\xa0]*$/.test(n)}function fi(){var n=V.navigator;return n&&(n=n.userAgent)?n:""}function Mt(n){return fi().indexOf(n)!=-1}function _o(n){return _o[" "](n),n}_o[" "]=function(){};function $f(n,t){var e=km;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}var Qf=Mt("Opera"),en=Mt("Trident")||Mt("MSIE"),Bc=Mt("Edge"),Xs=Bc||en,zc=Mt("Gecko")&&!(fi().toLowerCase().indexOf("webkit")!=-1&&!Mt("Edge"))&&!(Mt("Trident")||Mt("MSIE"))&&!Mt("Edge"),Wf=fi().toLowerCase().indexOf("webkit")!=-1&&!Mt("Edge");function Gc(){var n=V.document;return n?n.documentMode:void 0}var Zs;t:{if(ti="",ei=function(){var n=fi();if(zc)return/rv:([^\);]+)(\)|;)/.exec(n);if(Bc)return/Edge\/([\d\.]+)/.exec(n);if(en)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(Wf)return/WebKit\/(\S+)/.exec(n);if(Qf)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),ei&&(ti=ei?ei[1]:""),en&&(ni=Gc(),ni!=null&&ni>parseFloat(ti))){Zs=String(ni);break t}Zs=ti}var ti,ei,ni,to;V.document&&en?(Ws=Gc(),to=Ws||parseInt(Zs,10)||void 0):to=void 0;var Ws,Hf=to;function Jn(n,t){if(_t.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(zc){t:{try{_o(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:Jf[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Jn.$.h.call(this)}}ct(Jn,_t);var Jf={2:"touch",3:"pen",4:"mouse"};Jn.prototype.h=function(){Jn.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ir="closure_listenable_"+(1e6*Math.random()|0),Yf=0;function Xf(n,t,e,r,i){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!r,this.la=i,this.key=++Yf,this.fa=this.ia=!1}function mi(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function yo(n,t,e){for(let r in n)t.call(e,n[r],r,n)}function Zf(n,t){for(let e in n)t.call(void 0,n[e],e,n)}function Kc(n){let t={};for(let e in n)t[e]=n[e];return t}var xc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function jc(n,t){let e,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(e in r)n[e]=r[e];for(let s=0;s<xc.length;s++)e=xc[s],Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}}function gi(n){this.src=n,this.g={},this.h=0}gi.prototype.add=function(n,t,e,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=no(n,t,r,i);return-1<o?(t=n[o],e||(t.ia=!1)):(t=new Xf(t,this.src,s,!!r,i),t.ia=e,n.push(t)),t};function eo(n,t){var e=t.type;if(e in n.g){var r=n.g[e],i=Uc(r,t),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(mi(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function no(n,t,e,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==t&&s.capture==!!e&&s.la==r)return i}return-1}var wo="closure_lm_"+(1e6*Math.random()|0),Hs={};function $c(n,t,e,r,i){if(r&&r.once)return Wc(n,t,e,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)$c(n,t[s],e,r,i);return null}return e=To(e),n&&n[ir]?n.O(t,e,rr(r)?!!r.capture:!!r,i):Qc(n,t,e,!1,r,i)}function Qc(n,t,e,r,i,s){if(!t)throw Error("Invalid event type");var o=rr(i)?!!i.capture:!!i,a=Io(n);if(a||(n[wo]=a=new gi(n)),e=a.add(t,e,r,o,s),e.proxy)return e;if(r=tm(),e.proxy=r,r.src=n,r.listener=e,n.addEventListener)jf||(i=o),i===void 0&&(i=!1),n.addEventListener(t.toString(),r,i);else if(n.attachEvent)n.attachEvent(Jc(t.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return e}function tm(){function n(e){return t.call(n.src,n.listener,e)}let t=em;return n}function Wc(n,t,e,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Wc(n,t[s],e,r,i);return null}return e=To(e),n&&n[ir]?n.P(t,e,rr(r)?!!r.capture:!!r,i):Qc(n,t,e,!0,r,i)}function Hc(n,t,e,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Hc(n,t[s],e,r,i);else r=rr(r)?!!r.capture:!!r,e=To(e),n&&n[ir]?(n=n.i,t=String(t).toString(),t in n.g&&(s=n.g[t],e=no(s,e,r,i),-1<e&&(mi(s[e]),Array.prototype.splice.call(s,e,1),s.length==0&&(delete n.g[t],n.h--)))):n&&(n=Io(n))&&(t=n.g[t.toString()],n=-1,t&&(n=no(t,e,r,i)),(e=-1<n?t[n]:null)&&vo(e))}function vo(n){if(typeof n!="number"&&n&&!n.fa){var t=n.src;if(t&&t[ir])eo(t.i,n);else{var e=n.type,r=n.proxy;t.removeEventListener?t.removeEventListener(e,r,n.capture):t.detachEvent?t.detachEvent(Jc(e),r):t.addListener&&t.removeListener&&t.removeListener(r),(e=Io(t))?(eo(e,n),e.h==0&&(e.src=null,t[wo]=null)):mi(n)}}}function Jc(n){return n in Hs?Hs[n]:Hs[n]="on"+n}function em(n,t){if(n.fa)n=!0;else{t=new Jn(t,this);var e=n.listener,r=n.la||n.src;n.ia&&vo(n),n=e.call(r,t)}return n}function Io(n){return n=n[wo],n instanceof gi?n:null}var Js="__closure_events_fn_"+(1e9*Math.random()>>>0);function To(n){return typeof n=="function"?n:(n[Js]||(n[Js]=function(t){return n.handleEvent(t)}),n[Js])}function ut(){ie.call(this),this.i=new gi(this),this.S=this,this.J=null}ct(ut,ie);ut.prototype[ir]=!0;ut.prototype.removeEventListener=function(n,t,e,r){Hc(this,n,t,e,r)};function ft(n,t){var e,r=n.J;if(r)for(e=[];r;r=r.J)e.push(r);if(n=n.S,r=t.type||t,typeof t=="string")t=new _t(t,n);else if(t instanceof _t)t.target=t.target||n;else{var i=t;t=new _t(r,n),jc(t,i)}if(i=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.g=e[s];i=ri(o,r,!0,t)&&i}if(o=t.g=n,i=ri(o,r,!0,t)&&i,i=ri(o,r,!1,t)&&i,e)for(s=0;s<e.length;s++)o=t.g=e[s],i=ri(o,r,!1,t)&&i}ut.prototype.N=function(){if(ut.$.N.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],r=0;r<e.length;r++)mi(e[r]);delete n.g[t],n.h--}}this.J=null};ut.prototype.O=function(n,t,e,r){return this.i.add(String(n),t,!1,e,r)};ut.prototype.P=function(n,t,e,r){return this.i.add(String(n),t,!0,e,r)};function ri(n,t,e,r){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==e){var a=o.listener,u=o.la||o.src;o.ia&&eo(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Eo=V.JSON.stringify,ro=class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function nm(){var n=Ao;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var io=class{constructor(){this.h=this.g=null}add(t,e){let r=Yc.get();r.set(t,e),this.h?this.h.next=r:this.g=r,this.h=r}},Yc=new ro(()=>new so,n=>n.reset()),so=class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}};function rm(n){var t=1;n=n.split(":");let e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function im(n){V.setTimeout(()=>{throw n},0)}var Yn,Xn=!1,Ao=new io,Xc=()=>{let n=V.Promise.resolve(void 0);Yn=()=>{n.then(sm)}},sm=()=>{for(var n;n=nm();){try{n.h.call(n.g)}catch(e){im(e)}var t=Yc;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}Xn=!1};function pi(n,t){ut.call(this),this.h=n||1,this.g=t||V,this.j=pt(this.qb,this),this.l=Date.now()}ct(pi,ut);T=pi.prototype;T.ga=!1;T.T=null;T.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ft(this,"tick"),this.ga&&(So(this),this.start()))}};T.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function So(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}T.N=function(){pi.$.N.call(this),So(this),delete this.g};function Ro(n,t,e){if(typeof n=="function")e&&(n=pt(n,e));else if(n&&typeof n.handleEvent=="function")n=pt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:V.setTimeout(n,t||0)}function Zc(n){n.g=Ro(()=>{n.g=null,n.i&&(n.i=!1,Zc(n))},n.j);let t=n.h;n.h=null,n.m.apply(null,t)}var oo=class extends ie{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Zc(this)}N(){super.N(),this.g&&(V.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Zn(n){ie.call(this),this.h=n,this.g={}}ct(Zn,ie);var Dc=[];function tl(n,t,e,r){Array.isArray(e)||(e&&(Dc[0]=e.toString()),e=Dc);for(var i=0;i<e.length;i++){var s=$c(t,e[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function el(n){yo(n.g,function(t,e){this.g.hasOwnProperty(e)&&vo(t)},n),n.g={}}Zn.prototype.N=function(){Zn.$.N.call(this),el(this)};Zn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function _i(){this.g=!0}_i.prototype.Ea=function(){this.g=!1};function om(n,t,e,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+e+`
`+o})}function am(n,t,e,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+e+`
`+s+" "+o})}function Ze(n,t,e,r){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+cm(n,e)+(r?" "+r:"")})}function um(n,t){n.info(function(){return"TIMEOUT: "+t})}_i.prototype.info=function(){};function cm(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var r=e[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Eo(e)}catch{return t}}var xe={},bc=null;function yi(){return bc=bc||new ut}xe.Ta="serverreachability";function nl(n){_t.call(this,xe.Ta,n)}ct(nl,_t);function tr(n){let t=yi();ft(t,new nl(t))}xe.STAT_EVENT="statevent";function rl(n,t){_t.call(this,xe.STAT_EVENT,n),this.stat=t}ct(rl,_t);function vt(n){let t=yi();ft(t,new rl(t,n))}xe.Ua="timingevent";function il(n,t){_t.call(this,xe.Ua,n),this.size=t}ct(il,_t);function sr(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return V.setTimeout(function(){n()},t)}var wi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},sl={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Po(){}Po.prototype.h=null;function Cc(n){return n.h||(n.h=n.i())}function ol(){}var or={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Vo(){_t.call(this,"d")}ct(Vo,_t);function xo(){_t.call(this,"c")}ct(xo,_t);var ao;function vi(){}ct(vi,Po);vi.prototype.g=function(){return new XMLHttpRequest};vi.prototype.i=function(){return{}};ao=new vi;function ar(n,t,e,r){this.l=n,this.j=t,this.m=e,this.W=r||1,this.U=new Zn(this),this.P=lm,n=Xs?125:void 0,this.V=new pi(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new al}function al(){this.i=null,this.g="",this.h=!1}var lm=45e3,ul={},uo={};T=ar.prototype;T.setTimeout=function(n){this.P=n};function co(n,t,e){n.L=1,n.A=Ti(Ht(t)),n.u=e,n.S=!0,cl(n,null)}function cl(n,t){n.G=Date.now(),ur(n),n.B=Ht(n.A);var e=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),_l(e.i,"t",r),n.o=0,e=n.l.J,n.h=new al,n.g=Ol(n.l,e?t:null,!n.u),0<n.O&&(n.M=new oo(pt(n.Pa,n,n.g),n.O)),tl(n.U,n.g,"readystatechange",n.nb),t=n.I?Kc(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),tr(),om(n.j,n.v,n.B,n.m,n.W,n.u)}T.nb=function(n){n=n.target;let t=this.M;t&&Lt(n)==3?t.l():this.Pa(n)};T.Pa=function(n){try{if(n==this.g)t:{let l=Lt(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Xs||this.g&&(this.h.h||this.g.ja()||Mc(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?tr(3):tr(2)),Ii(this);var e=this.g.da();this.ca=e;e:if(ll(this)){var r=Mc(this.g);n="";var i=r.length,s=Lt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Re(this),Wn(this);var o="";break e}this.h.i=new V.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,n+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=e==200,am(this.j,this.v,this.B,this.m,this.W,l,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hn(a)){var c=a;break e}}c=null}if(e=c)Ze(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,lo(this,e);else{this.i=!1,this.s=3,vt(12),Re(this),Wn(this);break t}}this.S?(hl(this,l,o),Xs&&this.i&&l==3&&(tl(this.U,this.V,"tick",this.mb),this.V.start())):(Ze(this.j,this.m,o,null),lo(this,o)),l==4&&Re(this),this.i&&!this.J&&(l==4?kl(this.l,this):(this.i=!1,ur(this)))}else bm(this.g),e==400&&0<o.indexOf("Unknown SID")?(this.s=3,vt(12)):(this.s=0,vt(13)),Re(this),Wn(this)}}}catch{}finally{}};function ll(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function hl(n,t,e){let r=!0,i;for(;!n.J&&n.o<e.length;)if(i=hm(n,e),i==uo){t==4&&(n.s=4,vt(14),r=!1),Ze(n.j,n.m,null,"[Incomplete Response]");break}else if(i==ul){n.s=4,vt(15),Ze(n.j,n.m,e,"[Invalid Chunk]"),r=!1;break}else Ze(n.j,n.m,i,null),lo(n,i);ll(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),t!=4||e.length!=0||n.h.h||(n.s=1,vt(16),r=!1),n.i=n.i&&r,r?0<e.length&&!n.ba&&(n.ba=!0,t=n.l,t.g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Fo(t),t.M=!0,vt(11))):(Ze(n.j,n.m,e,"[Invalid Chunked Response]"),Re(n),Wn(n))}T.mb=function(){if(this.g){var n=Lt(this.g),t=this.g.ja();this.o<t.length&&(Ii(this),hl(this,n,t),this.i&&n!=4&&ur(this))}};function hm(n,t){var e=n.o,r=t.indexOf(`
`,e);return r==-1?uo:(e=Number(t.substring(e,r)),isNaN(e)?ul:(r+=1,r+e>t.length?uo:(t=t.slice(r,r+e),n.o=r+e,t)))}T.cancel=function(){this.J=!0,Re(this)};function ur(n){n.Y=Date.now()+n.P,dl(n,n.P)}function dl(n,t){if(n.C!=null)throw Error("WatchDog timer not null");n.C=sr(pt(n.lb,n),t)}function Ii(n){n.C&&(V.clearTimeout(n.C),n.C=null)}T.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(um(this.j,this.B),this.L!=2&&(tr(),vt(17)),Re(this),this.s=2,Wn(this)):dl(this,this.Y-n)};function Wn(n){n.l.H==0||n.J||kl(n.l,n)}function Re(n){Ii(n);var t=n.M;t&&typeof t.sa=="function"&&t.sa(),n.M=null,So(n.V),el(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function lo(n,t){try{var e=n.l;if(e.H!=0&&(e.g==n||ho(e.i,n))){if(!n.K&&ho(e.i,n)&&e.H==3){try{var r=e.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!e.u){if(e.g)if(e.g.G+3e3<n.G)ui(e),Si(e);else break t;ko(e),vt(18)}}else e.Fa=i[1],0<e.Fa-e.V&&37500>i[2]&&e.G&&e.A==0&&!e.v&&(e.v=sr(pt(e.ib,e),6e3));if(1>=vl(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else Pe(e,11)}else if((n.K||e.g==n)&&ui(e),!Hn(t))for(i=e.Ja.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(e.V=c[0],c=c[1],e.H==2)if(c[0]=="c"){e.K=c[1],e.pa=c[2];let l=c[3];l!=null&&(e.ra=l,e.l.info("VER="+e.ra));let h=c[4];h!=null&&(e.Ga=h,e.l.info("SVER="+e.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,e.L=r,e.l.info("backChannelRequestTimeoutMs_="+r)),r=e;let m=n.g;if(m){let A=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(A){var s=r.i;s.g||A.indexOf("spdy")==-1&&A.indexOf("quic")==-1&&A.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Do(s,s.h),s.h=null))}if(r.F){let w=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,G(r.I,r.F,w))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms")),r=e;var o=n;if(r.wa=Ll(r,r.J?r.pa:null,r.Y),o.K){Il(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Ii(a),ur(a)),r.g=o}else Cl(r);0<e.j.length&&Ri(e)}else c[0]!="stop"&&c[0]!="close"||Pe(e,7);else e.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Pe(e,7):No(e):c[0]!="noop"&&e.h&&e.h.Aa(c),e.A=0)}}tr(4)}catch{}}function dm(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(di(n)){for(var t=[],e=n.length,r=0;r<e;r++)t.push(n[r]);return t}t=[],e=0;for(r in n)t[e++]=n[r];return t}function fm(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(di(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(let r in n)t[e++]=r;return t}}}function fl(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(di(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=fm(n),r=dm(n),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],e&&e[s],n)}var ml=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mm(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var r=n[e].indexOf("="),i=null;if(0<=r){var s=n[e].substring(0,r);i=n[e].substring(r+1)}else s=n[e];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Ve(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ve){this.h=n.h,oi(this,n.j),this.s=n.s,this.g=n.g,ai(this,n.m),this.l=n.l;var t=n.i,e=new er;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),Nc(this,e),this.o=n.o}else n&&(t=String(n).match(ml))?(this.h=!1,oi(this,t[1]||"",!0),this.s=$n(t[2]||""),this.g=$n(t[3]||"",!0),ai(this,t[4]),this.l=$n(t[5]||"",!0),Nc(this,t[6]||"",!0),this.o=$n(t[7]||"")):(this.h=!1,this.i=new er(null,this.h))}Ve.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Qn(t,kc,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(Qn(t,kc,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(Qn(e,e.charAt(0)=="/"?_m:pm,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Qn(e,wm)),n.join("")};function Ht(n){return new Ve(n)}function oi(n,t,e){n.j=e?$n(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function ai(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function Nc(n,t,e){t instanceof er?(n.i=t,vm(n.i,n.h)):(e||(t=Qn(t,ym)),n.i=new er(t,n.h))}function G(n,t,e){n.i.set(t,e)}function Ti(n){return G(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function $n(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Qn(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,gm),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function gm(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var kc=/[#\/\?@]/g,pm=/[#\?:]/g,_m=/[#\?]/g,ym=/[#\?@]/g,wm=/#/g;function er(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function se(n){n.g||(n.g=new Map,n.h=0,n.i&&mm(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}T=er.prototype;T.add=function(n,t){se(this),this.i=null,n=nn(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function gl(n,t){se(n),t=nn(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function pl(n,t){return se(n),t=nn(n,t),n.g.has(t)}T.forEach=function(n,t){se(this),this.g.forEach(function(e,r){e.forEach(function(i){n.call(t,i,r,this)},this)},this)};T.ta=function(){se(this);let n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let r=0;r<t.length;r++){let i=n[r];for(let s=0;s<i.length;s++)e.push(t[r])}return e};T.Z=function(n){se(this);let t=[];if(typeof n=="string")pl(this,n)&&(t=t.concat(this.g.get(nn(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};T.set=function(n,t){return se(this),this.i=null,n=nn(this,n),pl(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};T.get=function(n,t){return n?(n=this.Z(n),0<n.length?String(n[0]):t):t};function _l(n,t,e){gl(n,t),0<e.length&&(n.i=null,n.g.set(nn(n,t),po(e)),n.h+=e.length)}T.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var r=t[e];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function nn(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function vm(n,t){t&&!n.j&&(se(n),n.i=null,n.g.forEach(function(e,r){var i=r.toLowerCase();r!=i&&(gl(this,r),_l(this,i,e))},n)),n.j=t}var Im=class{constructor(n,t){this.g=n,this.map=t}};function yl(n){this.l=n||Tm,V.PerformanceNavigationTiming?(n=V.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(V.g&&V.g.Ka&&V.g.Ka()&&V.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Tm=10;function wl(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function vl(n){return n.h?1:n.g?n.g.size:0}function ho(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function Do(n,t){n.g?n.g.add(t):n.h=t}function Il(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}yl.prototype.cancel=function(){if(this.i=Tl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function Tl(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let t=n.i;for(let e of n.g.values())t=t.concat(e.F);return t}return po(n.i)}var Em=class{stringify(n){return V.JSON.stringify(n,void 0)}parse(n){return V.JSON.parse(n,void 0)}};function Am(){this.g=new Em}function Sm(n,t,e){let r=e||"";try{fl(n,function(i,s){let o=i;rr(i)&&(o=Eo(i)),t.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Rm(n,t){let e=new _i;if(V.Image){let r=new Image;r.onload=Zr(ii,e,r,"TestLoadImage: loaded",!0,t),r.onerror=Zr(ii,e,r,"TestLoadImage: error",!1,t),r.onabort=Zr(ii,e,r,"TestLoadImage: abort",!1,t),r.ontimeout=Zr(ii,e,r,"TestLoadImage: timeout",!1,t),V.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else t(!1)}function ii(n,t,e,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function cr(n){this.l=n.ec||null,this.j=n.ob||!1}ct(cr,Po);cr.prototype.g=function(){return new Ei(this.l,this.j)};cr.prototype.i=function(n){return function(){return n}}({});function Ei(n,t){ut.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=bo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ct(Ei,ut);var bo=0;T=Ei.prototype;T.open=function(n,t){if(this.readyState!=bo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,nr(this)};T.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||V).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};T.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,lr(this)),this.readyState=bo};T.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,nr(this)),this.g&&(this.readyState=3,nr(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof V.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;El(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function El(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}T.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?lr(this):nr(this),this.readyState==3&&El(this)}};T.Za=function(n){this.g&&(this.response=this.responseText=n,lr(this))};T.Ya=function(n){this.g&&(this.response=n,lr(this))};T.ka=function(){this.g&&lr(this)};function lr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,nr(n)}T.setRequestHeader=function(n,t){this.v.append(n,t)};T.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};T.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function nr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Ei.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Pm=V.JSON.parse;function Q(n){ut.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Al,this.L=this.M=!1}ct(Q,ut);var Al="",Vm=/^https?$/i,xm=["POST","PUT"];T=Q.prototype;T.Oa=function(n){this.M=n};T.ha=function(n,t,e,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ao.g(),this.C=this.u?Cc(this.u):Cc(ao),this.g.onreadystatechange=pt(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(s){Fc(this,s);return}if(n=e||"",e=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)e.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())e.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(e.keys()).find(s=>s.toLowerCase()=="content-type"),i=V.FormData&&n instanceof V.FormData,!(0<=Uc(xm,t))||r||i||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of e)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Pl(this),0<this.B&&((this.L=Dm(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pt(this.ua,this)):this.A=Ro(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Fc(this,s)}};function Dm(n){return en&&typeof n.timeout=="number"&&n.ontimeout!==void 0}T.ua=function(){typeof go<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ft(this,"timeout"),this.abort(8))};function Fc(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,Sl(n),Ai(n)}function Sl(n){n.F||(n.F=!0,ft(n,"complete"),ft(n,"error"))}T.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ft(this,"complete"),ft(this,"abort"),Ai(this))};T.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ai(this,!0)),Q.$.N.call(this)};T.La=function(){this.s||(this.G||this.v||this.l?Rl(this):this.kb())};T.kb=function(){Rl(this)};function Rl(n){if(n.h&&typeof go<"u"&&(!n.C[1]||Lt(n)!=4||n.da()!=2)){if(n.v&&Lt(n)==4)Ro(n.La,0,n);else if(ft(n,"readystatechange"),Lt(n)==4){n.h=!1;try{let o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var r;if(r=o===0){var i=String(n.I).match(ml)[1]||null;!i&&V.self&&V.self.location&&(i=V.self.location.protocol.slice(0,-1)),r=!Vm.test(i?i.toLowerCase():"")}e=r}if(e)ft(n,"complete"),ft(n,"success");else{n.m=6;try{var s=2<Lt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Sl(n)}}finally{Ai(n)}}}}function Ai(n,t){if(n.g){Pl(n);let e=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||ft(n,"ready");try{e.onreadystatechange=r}catch{}}}function Pl(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(V.clearTimeout(n.A),n.A=null)}T.isActive=function(){return!!this.g};function Lt(n){return n.g?n.g.readyState:0}T.da=function(){try{return 2<Lt(this)?this.g.status:-1}catch{return-1}};T.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};T.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),Pm(t)}};function Mc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Al:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function bm(n){let t={};n=(n.g&&2<=Lt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Hn(n[r]))continue;var e=rm(n[r]);let i=e[0];if(e=e[1],typeof e!="string")continue;e=e.trim();let s=t[i]||[];t[i]=s,s.push(e)}Zf(t,function(r){return r.join(", ")})}T.Ia=function(){return this.m};T.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Vl(n){let t="";return yo(n,function(e,r){t+=r,t+=":",t+=e,t+=`\r
`}),t}function Co(n,t,e){t:{for(r in e){var r=!1;break t}r=!0}r||(e=Vl(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):G(n,t,e))}function Kn(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function xl(n){this.Ga=0,this.j=[],this.l=new _i,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Kn("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Kn("baseRetryDelayMs",5e3,n),this.hb=Kn("retryDelaySeedMs",1e4,n),this.eb=Kn("forwardChannelMaxRetries",2,n),this.xa=Kn("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new yl(n&&n.concurrentRequestLimit),this.Ja=new Am,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}T=xl.prototype;T.ra=8;T.H=1;function No(n){if(Dl(n),n.H==3){var t=n.W++,e=Ht(n.I);if(G(e,"SID",n.K),G(e,"RID",t),G(e,"TYPE","terminate"),hr(n,e),t=new ar(n,n.l,t),t.L=2,t.A=Ti(Ht(e)),e=!1,V.navigator&&V.navigator.sendBeacon)try{e=V.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&V.Image&&(new Image().src=t.A,e=!0),e||(t.g=Ol(t.l,null),t.g.ha(t.A)),t.G=Date.now(),ur(t)}Ml(n)}function Si(n){n.g&&(Fo(n),n.g.cancel(),n.g=null)}function Dl(n){Si(n),n.u&&(V.clearTimeout(n.u),n.u=null),ui(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&V.clearTimeout(n.m),n.m=null)}function Ri(n){if(!wl(n.i)&&!n.m){n.m=!0;var t=n.Na;Yn||Xc(),Xn||(Yn(),Xn=!0),Ao.add(t,n),n.C=0}}function Cm(n,t){return vl(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=t.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=sr(pt(n.Na,n,t),Fl(n,n.C)),n.C++,!0)}T.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new ar(this,this.l,n),s=this.s;if(this.U&&(s?(s=Kc(s),jc(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){e:{var r=this.j[e];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=e;break t}if(t===4096||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=bl(this,i,t),e=Ht(this.I),G(e,"RID",n),G(e,"CVER",22),this.F&&G(e,"X-HTTP-Session-Id",this.F),hr(this,e),s&&(this.O?t="headers="+encodeURIComponent(String(Vl(s)))+"&"+t:this.o&&Co(e,this.o,s)),Do(this.i,i),this.bb&&G(e,"TYPE","init"),this.P?(G(e,"$req",t),G(e,"SID","null"),i.aa=!0,co(i,e,null)):co(i,e,t),this.H=2}}else this.H==3&&(n?Lc(this,n):this.j.length==0||wl(this.i)||Lc(this))};function Lc(n,t){var e;t?e=t.m:e=n.W++;let r=Ht(n.I);G(r,"SID",n.K),G(r,"RID",e),G(r,"AID",n.V),hr(n,r),n.o&&n.s&&Co(r,n.o,n.s),e=new ar(n,n.l,e,n.C+1),n.o===null&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=bl(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Do(n.i,e),co(e,r,t)}function hr(n,t){n.na&&yo(n.na,function(e,r){G(t,r,e)}),n.h&&fl({},function(e,r){G(t,r,e)})}function bl(n,t,e){e=Math.min(n.j.length,e);var r=n.h?pt(n.h.Va,n.h,n):null;t:{var i=n.j;let s=-1;for(;;){let o=["count="+e];s==-1?0<e?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<e;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Sm(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,r}function Cl(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;Yn||Xc(),Xn||(Yn(),Xn=!0),Ao.add(t,n),n.A=0}}function ko(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=sr(pt(n.Ma,n),Fl(n,n.A)),n.A++,!0)}T.Ma=function(){if(this.u=null,Nl(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=sr(pt(this.jb,this),n)}};T.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,vt(10),Si(this),Nl(this))};function Fo(n){n.B!=null&&(V.clearTimeout(n.B),n.B=null)}function Nl(n){n.g=new ar(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var t=Ht(n.wa);G(t,"RID","rpc"),G(t,"SID",n.K),G(t,"AID",n.V),G(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&G(t,"TO",n.qa),G(t,"TYPE","xmlhttp"),hr(n,t),n.o&&n.s&&Co(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=Ti(Ht(t)),e.u=null,e.S=!0,cl(e,n)}T.ib=function(){this.v!=null&&(this.v=null,Si(this),ko(this),vt(19))};function ui(n){n.v!=null&&(V.clearTimeout(n.v),n.v=null)}function kl(n,t){var e=null;if(n.g==t){ui(n),Fo(n),n.g=null;var r=2}else if(ho(n.i,t))e=t.F,Il(n.i,t),r=1;else return;if(n.H!=0){if(t.i)if(r==1){e=t.u?t.u.length:0,t=Date.now()-t.G;var i=n.C;r=yi(),ft(r,new il(r,e)),Ri(n)}else Cl(n);else if(i=t.s,i==3||i==0&&0<t.ca||!(r==1&&Cm(n,t)||r==2&&ko(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),i){case 1:Pe(n,5);break;case 4:Pe(n,10);break;case 3:Pe(n,6);break;default:Pe(n,2)}}}function Fl(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function Pe(n,t){if(n.l.info("Error code "+t),t==2){var e=null;n.h&&(e=null);var r=pt(n.pb,n);e||(e=new Ve("//www.google.com/images/cleardot.gif"),V.location&&V.location.protocol=="http"||oi(e,"https"),Ti(e)),Rm(e.toString(),r)}else vt(2);n.H=0,n.h&&n.h.za(t),Ml(n),Dl(n)}T.pb=function(n){n?(this.l.info("Successfully pinged google.com"),vt(2)):(this.l.info("Failed to ping google.com"),vt(1))};function Ml(n){if(n.H=0,n.ma=[],n.h){let t=Tl(n.i);(t.length!=0||n.j.length!=0)&&(Vc(n.ma,t),Vc(n.ma,n.j),n.i.i.length=0,po(n.j),n.j.length=0),n.h.ya()}}function Ll(n,t,e){var r=e instanceof Ve?Ht(e):new Ve(e);if(r.g!="")t&&(r.g=t+"."+r.g),ai(r,r.m);else{var i=V.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Ve(null);r&&oi(s,r),t&&(s.g=t),i&&ai(s,i),e&&(s.l=e),r=s}return e=n.F,t=n.Da,e&&t&&G(r,e,t),G(r,"VER",n.ra),hr(n,r),r}function Ol(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=n.Ha&&!n.va?new Q(new cr({ob:e})):new Q(n.va),t.Oa(n.J),t}T.isActive=function(){return!!this.h&&this.h.isActive(this)};function ql(){}T=ql.prototype;T.Ba=function(){};T.Aa=function(){};T.za=function(){};T.ya=function(){};T.isActive=function(){return!0};T.Va=function(){};function ci(){if(en&&!(10<=Number(Hf)))throw Error("Environmental error: no available transport.")}ci.prototype.g=function(n,t){return new At(n,t)};function At(n,t){ut.call(this),this.g=new xl(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!Hn(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Hn(t)&&(this.g.F=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new rn(this)}ct(At,ut);At.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;vt(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=Ll(n,null,n.Y),Ri(n)};At.prototype.close=function(){No(this.g)};At.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=Eo(n),n=e);t.j.push(new Im(t.fb++,n)),t.H==3&&Ri(t)};At.prototype.N=function(){this.g.h=null,delete this.j,No(this.g),delete this.g,At.$.N.call(this)};function Ul(n){Vo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(let e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}ct(Ul,Vo);function Bl(){xo.call(this),this.status=1}ct(Bl,xo);function rn(n){this.g=n}ct(rn,ql);rn.prototype.Ba=function(){ft(this.g,"a")};rn.prototype.Aa=function(n){ft(this.g,new Ul(n))};rn.prototype.za=function(n){ft(this.g,new Bl)};rn.prototype.ya=function(){ft(this.g,"b")};function Nm(){this.blockSize=-1}function Dt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}ct(Dt,Nm);Dt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Ys(n,t,e){e||(e=0);var r=Array(16);if(typeof t=="string")for(var i=0;16>i;++i)r[i]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(i=0;16>i;++i)r[i]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=n.g[0],e=n.g[1],i=n.g[2];var s=n.g[3],o=t+(s^e&(i^s))+r[0]+3614090360&4294967295;t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[3]+3250441966&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[4]+4118548399&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[7]+4249261313&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[8]+1770035416&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[11]+2304563134&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[12]+1804603682&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[15]+1236535329&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(i^s&(e^i))+r[1]+4129170786&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[0]+3921069994&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[5]+3593408605&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[4]+3889429448&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[9]+568446438&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[8]+1163531501&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[13]+2850285829&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[12]+2368359562&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(e^i^s)+r[5]+4294588738&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[14]+4259657740&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[1]+2763975236&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[10]+3200236656&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[13]+681279174&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[6]+76029189&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[9]+3654602809&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[2]+3299628645&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(i^(e|~s))+r[0]+4096336452&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[5]+4237533241&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[12]+1700485571&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[1]+2240044497&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[8]+1873313359&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[13]+1309151649&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[4]+4149444226&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Dt.prototype.j=function(n,t){t===void 0&&(t=n.length);for(var e=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(i==0)for(;s<=e;)Ys(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<t;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Ys(this,r),i=0;break}}else for(;s<t;)if(r[i++]=n[s++],i==this.blockSize){Ys(this,r),i=0;break}}this.h=i,this.i+=t};Dt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=e&255,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var r=0;32>r;r+=8)n[e++]=this.g[t]>>>r&255;return n};function q(n,t){this.h=t;for(var e=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==t||(e[i]=s,r=!1)}this.g=e}var km={};function Mo(n){return-128<=n&&128>n?$f(n,function(t){return new q([t|0],0>t?-1:0)}):new q([n|0],0>n?-1:0)}function Ot(n){if(isNaN(n)||!isFinite(n))return tn;if(0>n)return dt(Ot(-n));for(var t=[],e=1,r=0;n>=e;r++)t[r]=n/e|0,e*=fo;return new q(t,0)}function zl(n,t){if(n.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return dt(zl(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=Ot(Math.pow(t,8)),r=tn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),t);8>s?(s=Ot(Math.pow(t,s)),r=r.R(s).add(Ot(o))):(r=r.R(e),r=r.add(Ot(o)))}return r}var fo=4294967296,tn=Mo(0),mo=Mo(1),Oc=Mo(16777216);T=q.prototype;T.ea=function(){if(Pt(this))return-dt(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var r=this.D(e);n+=(0<=r?r:fo+r)*t,t*=fo}return n};T.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Wt(this))return"0";if(Pt(this))return"-"+dt(this).toString(n);for(var t=Ot(Math.pow(n,6)),e=this,r="";;){var i=hi(e,t).g;e=li(e,i.R(t));var s=((0<e.g.length?e.g[0]:e.h)>>>0).toString(n);if(e=i,Wt(e))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};T.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Wt(n){if(n.h!=0)return!1;for(var t=0;t<n.g.length;t++)if(n.g[t]!=0)return!1;return!0}function Pt(n){return n.h==-1}T.X=function(n){return n=li(this,n),Pt(n)?-1:Wt(n)?0:1};function dt(n){for(var t=n.g.length,e=[],r=0;r<t;r++)e[r]=~n.g[r];return new q(e,~n.h).add(mo)}T.abs=function(){return Pt(this)?dt(this):this};T.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0,i=0;i<=t;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,e[i]=o<<16|s}return new q(e,e[e.length-1]&-2147483648?-1:0)};function li(n,t){return n.add(dt(t))}T.R=function(n){if(Wt(this)||Wt(n))return tn;if(Pt(this))return Pt(n)?dt(this).R(dt(n)):dt(dt(this).R(n));if(Pt(n))return dt(this.R(dt(n)));if(0>this.X(Oc)&&0>n.X(Oc))return Ot(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],r=0;r<2*t;r++)e[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;e[2*r+2*i]+=o*u,si(e,2*r+2*i),e[2*r+2*i+1]+=s*u,si(e,2*r+2*i+1),e[2*r+2*i+1]+=o*a,si(e,2*r+2*i+1),e[2*r+2*i+2]+=s*a,si(e,2*r+2*i+2)}for(r=0;r<t;r++)e[r]=e[2*r+1]<<16|e[2*r];for(r=t;r<2*t;r++)e[r]=0;return new q(e,0)};function si(n,t){for(;(n[t]&65535)!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function jn(n,t){this.g=n,this.h=t}function hi(n,t){if(Wt(t))throw Error("division by zero");if(Wt(n))return new jn(tn,tn);if(Pt(n))return t=hi(dt(n),t),new jn(dt(t.g),dt(t.h));if(Pt(t))return t=hi(n,dt(t)),new jn(dt(t.g),t.h);if(30<n.g.length){if(Pt(n)||Pt(t))throw Error("slowDivide_ only works with positive integers.");for(var e=mo,r=t;0>=r.X(n);)e=qc(e),r=qc(r);var i=Xe(e,1),s=Xe(r,1);for(r=Xe(r,2),e=Xe(e,2);!Wt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(e),s=o),r=Xe(r,1),e=Xe(e,1)}return t=li(n,i.R(t)),new jn(i,t)}for(i=tn;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),r=Math.ceil(Math.log(e)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Ot(e),o=s.R(t);Pt(o)||0<o.X(n);)e-=r,s=Ot(e),o=s.R(t);Wt(s)&&(s=mo),i=i.add(s),n=li(n,o)}return new jn(i,n)}T.gb=function(n){return hi(this,n).h};T.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)&n.D(r);return new q(e,this.h&n.h)};T.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)|n.D(r);return new q(e,this.h|n.h)};T.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)^n.D(r);return new q(e,this.h^n.h)};function qc(n){for(var t=n.g.length+1,e=[],r=0;r<t;r++)e[r]=n.D(r)<<1|n.D(r-1)>>>31;return new q(e,n.h)}function Xe(n,t){var e=t>>5;t%=32;for(var r=n.g.length-e,i=[],s=0;s<r;s++)i[s]=0<t?n.D(s+e)>>>t|n.D(s+e+1)<<32-t:n.D(s+e);return new q(i,n.h)}ci.prototype.createWebChannel=ci.prototype.g;At.prototype.send=At.prototype.u;At.prototype.open=At.prototype.m;At.prototype.close=At.prototype.close;wi.NO_ERROR=0;wi.TIMEOUT=8;wi.HTTP_ERROR=6;sl.COMPLETE="complete";ol.EventType=or;or.OPEN="a";or.CLOSE="b";or.ERROR="c";or.MESSAGE="d";ut.prototype.listen=ut.prototype.O;Q.prototype.listenOnce=Q.prototype.P;Q.prototype.getLastError=Q.prototype.Sa;Q.prototype.getLastErrorCode=Q.prototype.Ia;Q.prototype.getStatus=Q.prototype.da;Q.prototype.getResponseJson=Q.prototype.Wa;Q.prototype.getResponseText=Q.prototype.ja;Q.prototype.send=Q.prototype.ha;Q.prototype.setWithCredentials=Q.prototype.Oa;Dt.prototype.digest=Dt.prototype.l;Dt.prototype.reset=Dt.prototype.reset;Dt.prototype.update=Dt.prototype.j;q.prototype.add=q.prototype.add;q.prototype.multiply=q.prototype.R;q.prototype.modulo=q.prototype.gb;q.prototype.compare=q.prototype.X;q.prototype.toNumber=q.prototype.ea;q.prototype.toString=q.prototype.toString;q.prototype.getBits=q.prototype.D;q.fromNumber=Ot;q.fromString=zl;var Gl=bt.createWebChannelTransport=function(){return new ci},Kl=bt.getStatEventTarget=function(){return yi()},Pi=bt.ErrorCode=wi,jl=bt.EventType=sl,$l=bt.Event=xe,Lo=bt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ql=bt.FetchXmlHttpFactory=cr,dr=bt.WebChannel=ol,Wl=bt.XhrIo=Q,Hl=bt.Md5=Dt,De=bt.Integer=q;var Jl="@firebase/firestore";var nt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};nt.UNAUTHENTICATED=new nt(null),nt.GOOGLE_CREDENTIALS=new nt("google-credentials-uid"),nt.FIRST_PARTY=new nt("first-party-uid"),nt.MOCK_USER=new nt("mock-user");var Ln="10.11.1";var he=new Ec("@firebase/firestore");function cn(){return he.logLevel}function zp(n){he.setLogLevel(n)}function _(n,...t){if(he.logLevel<=Ft.DEBUG){let e=t.map(Uu);he.debug(`Firestore (${Ln}): ${n}`,...e)}}function J(n,...t){if(he.logLevel<=Ft.ERROR){let e=t.map(Uu);he.error(`Firestore (${Ln}): ${n}`,...e)}}function Kt(n,...t){if(he.logLevel<=Ft.WARN){let e=t.map(Uu);he.warn(`Firestore (${Ln}): ${n}`,...e)}}function Uu(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function S(n="Unexpected state"){let t=`FIRESTORE (${Ln}) INTERNAL ASSERTION FAILED: `+n;throw J(t),new Error(t)}function R(n,t){n||S()}function Gp(n,t){n||S()}function I(n,t){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends Ic{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var rt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Oi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},zo=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(nt.UNAUTHENTICATED))}shutdown(){}},Go=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ko=class{constructor(t){this.t=t,this.currentUser=nt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let r=this.i,i=u=>this.i!==r?(r=this.i,e(u)):Promise.resolve(),s=new rt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new rt,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;t.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new rt)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(R(typeof r.accessToken=="string"),new Oi(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return R(t===null||typeof t=="string"),new nt(t)}},jo=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=nt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},$o=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new jo(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(nt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Qo=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Wo=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let r=s=>{s.error!=null&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,_("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(R(typeof e.token=="string"),this.R=e.token,new Qo(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Fm(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var qi=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=Fm(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+=t.charAt(i[s]%t.length))}return r}};function D(n,t){return n<t?-1:n>t?1:0}function wn(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}function Yh(n){return n+"\0"}var Y=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?D(this.nanoseconds,t.nanoseconds):D(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var P=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new Y(0,0))}static max(){return new n(new Y(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ui=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&S(),r===void 0?r=t.length-e:r>t.length-e&&S(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let i=0;i<r;i++){let s=t.get(i),o=e.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},M=class n extends Ui{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new n(e)}static emptyPath(){return new n([])}},Mm=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ot=class n extends Ui{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return Mm.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",i=0,s=()=>{if(r.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},o=!1;for(;i<t.length;){let a=t[i];if(a==="\\"){if(i+1===t.length)throw new y(g.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let u=t[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new y(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(g.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var E=class n{constructor(t){this.path=t}static fromPath(t){return new n(M.fromString(t))}static fromName(t){return new n(M.fromString(t).popFirst(5))}static empty(){return new n(M.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&M.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return M.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new M(t.slice()))}};var vn=class{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}};function Ho(n){return n.fields.find(t=>t.kind===2)}function Ce(n){return n.fields.filter(t=>t.kind!==2)}vn.UNKNOWN_ID=-1;var gn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var Ar=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,xt.min())}};function Xh(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=P.fromTimestamp(r===1e9?new Y(e+1,0):new Y(e,r));return new xt(i,E.empty(),t)}function Zh(n){return new xt(n.readTime,n.key,-1)}var xt=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(P.min(),E.empty(),-1)}static max(){return new n(P.max(),E.empty(),-1)}};function Bu(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=E.comparator(n.documentKey,t.documentKey),e!==0?e:D(n.largestBatchId,t.largestBatchId))}var td="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Bi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ee(n){return p(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==td)throw n;_("LocalStore","Unexpectedly lost primary lease")})}var f=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let i=0,s=0,o=!1;t.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&e()},u=>r(u))}),o=!0,s===i&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(i=>i?n.resolve(i):r());return e}static forEach(t,e){let r=[];return t.forEach((i,s)=>{r.push(e.call(this,i,s))}),this.waitFor(r)}static mapArray(t,e){return new n((r,i)=>{let s=t.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;e(t[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(t,e){return new n((r,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):r()};s()})}};var zi=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new rt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Oe(t,e.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=zu(r.target.error);this.V.reject(new Oe(t,i))}}static open(t,e,r,i){try{return new n(e,t.transaction(i,r))}catch(s){throw new Oe(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(_("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Yo(e)}},de=class n{constructor(t,e,r){this.name=t,this.version=e,this.p=r,n.S(Gn())===12.2&&J("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return _("SimpleDb","Removing database:",t),Ne(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!vc())return!1;if(n.C())return!0;let t=Gn(),e=n.S(t),r=0<e&&e<10,i=ed(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.v)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(t){return p(this,null,function*(){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;e(o)},i.onblocked=()=>{r(new Oe(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new y(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new y(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Oe(t,o))},i.onupgradeneeded=s=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,r,i){return p(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(t);let a=zi.open(this.db,t,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),f.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(_("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function ed(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Jo=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return Ne(this.B.delete())}},Oe=class extends y{constructor(t,e){super(g.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Ae(n){return n.name==="IndexedDbTransactionError"}var Yo=class{constructor(t){this.store=t}put(t,e){let r;return e!==void 0?(_("SimpleDb","PUT",this.store.name,t,e),r=this.store.put(e,t)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),Ne(r)}add(t){return _("SimpleDb","ADD",this.store.name,t,t),Ne(this.store.add(t))}get(t){return Ne(this.store.get(t)).next(e=>(e===void 0&&(e=null),_("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return _("SimpleDb","DELETE",this.store.name,t),Ne(this.store.delete(t))}count(){return _("SimpleDb","COUNT",this.store.name),Ne(this.store.count())}U(t,e){let r=this.options(t,e),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new f((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(t,e){let r=this.store.getAll(t,e===null?void 0:e);return new f((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(t,e){_("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,e);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(t,e){let r;e?r=t:(r={},e=t);let i=this.cursor(r);return this.W(i,e)}Y(t){let e=this.cursor({});return new f((r,i)=>{e.onerror=s=>{let o=zu(s.target.error);i(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(t,e){let r=[];return new f((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new Jo(a),c=e(a.primaryKey,a.value,u);if(c instanceof f){let l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>f.waitFor(r))}options(t,e){let r;return t!==void 0&&(typeof t=="string"?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let r=this.store.index(t.index);return t.H?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function Ne(n){return new f((t,e)=>{n.onsuccess=r=>{let i=r.target.result;t(i)},n.onerror=r=>{let i=zu(r.target.error);e(i)}})}var Yl=!1;function zu(n){let t=de.S(Gn());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Yl||(Yl=!0,setTimeout(()=>{throw r},0)),r}}return n}var Xo=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){_("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>p(this,null,function*(){this.task=null;try{_("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){Ae(e)?_("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield Ee(e)}yield this.X(6e4)}))}},Zo=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let r=new Set,i=e,s=!0;return f.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!r.has(o))return _("IndexBackfiller",`Processing collection: ${o}`),this.ne(t,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>e-i)}ne(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.re(i,s)).next(a=>(_("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}re(t,e){let r=t;return e.changes.forEach((i,s)=>{let o=Zh(s);Bu(o,r)>0&&(r=o)}),new xt(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}};var St=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return n.oe=-1,n})();function Qr(n){return n==null}function Sr(n){return n===0&&1/n==-1/0}function nd(n){return typeof n=="number"&&Number.isInteger(n)&&!Sr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function It(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Xl(t)),t=Lm(n.get(e),t);return Xl(t)}function Lm(n,t){let e=t,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Xl(n){return n+""}function qt(n){let t=n.length;if(R(t>=2),t===2)return R(n.charAt(0)===""&&n.charAt(1)===""),M.emptyPath();let e=t-2,r=[],i="";for(let s=0;s<t;){let o=n.indexOf("",s);switch((o<0||o>e)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new M(r)}var Zl=["userId","batchId"];function Ci(n,t){return[n,It(t)]}function rd(n,t,e){return[n,It(t),e]}var Om={},qm=["prefixPath","collectionGroup","readTime","documentId"],Um=["prefixPath","collectionGroup","documentId"],Bm=["collectionGroup","readTime","prefixPath","documentId"],zm=["canonicalId","targetId"],Gm=["targetId","path"],Km=["path","targetId"],jm=["collectionId","parent"],$m=["indexId","uid"],Qm=["uid","sequenceNumber"],Wm=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Hm=["indexId","uid","orderedDocumentKey"],Jm=["userId","collectionPath","documentId"],Ym=["userId","collectionPath","largestBatchId"],Xm=["userId","collectionGroup","largestBatchId"],id=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Zm=[...id,"documentOverlays"],sd=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],od=sd,ad=[...od,"indexConfiguration","indexState","indexEntries"],tg=ad;var Rr=class extends Bi{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function ht(n,t){let e=I(n);return de.F(e._e,t)}function th(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function He(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function ud(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var K=class n{constructor(t,e){this.comparator=t,this.root=e||Bt.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Bt.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Bt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new mn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new mn(this.root,t,this.comparator,!1)}getReverseIterator(){return new mn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new mn(this.root,t,this.comparator,!0)}},mn=class{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Bt=class n{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new n(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}};Bt.EMPTY=null,Bt.RED=!0,Bt.BLACK=!1;Bt.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,r,i,s){return this}insert(t,e,r){return new Bt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var B=class n{constructor(t){this.comparator=t,this.data=new K(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Gi(this.data.getIterator())}getIteratorFrom(t){return new Gi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Gi=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function sn(n){return n.hasNext()?n.getNext():void 0}var Rt=class n{constructor(t){this.fields=t,t.sort(ot.comparator)}static empty(){return new n([])}unionWith(t){let e=new B(ot.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return wn(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Ki=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function jp(){return typeof atob<"u"}var lt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ki("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return D(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};lt.EMPTY_BYTE_STRING=new lt("");var eg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xt(n){if(R(!!n),typeof n=="string"){let t=0,e=eg.exec(n);if(R(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:W(n.seconds),nanos:W(n.nanos)}}function W(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fe(n){return typeof n=="string"?lt.fromBase64String(n):lt.fromUint8Array(n)}function ks(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Gu(n){let t=n.mapValue.fields.__previous_value__;return ks(t)?Gu(t):t}function Pr(n){let t=Xt(n.mapValue.fields.__local_write_time__.timestampValue);return new Y(t.seconds,t.nanos)}var ta=class{constructor(t,e,r,i,s,o,a,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},In=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var le={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ni={nullValue:"NULL_VALUE"};function qe(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ks(n)?4:cd(n)?9007199254740991:10:S()}function jt(n,t){if(n===t)return!0;let e=qe(n);if(e!==qe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Pr(n).isEqual(Pr(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Xt(i.timestampValue),a=Xt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(i,s){return fe(i.bytesValue).isEqual(fe(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return W(i.geoPointValue.latitude)===W(s.geoPointValue.latitude)&&W(i.geoPointValue.longitude)===W(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return W(i.integerValue)===W(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=W(i.doubleValue),a=W(s.doubleValue);return o===a?Sr(o)===Sr(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return wn(n.arrayValue.values||[],t.arrayValue.values||[],jt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(th(o)!==th(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!jt(o[u],a[u])))return!1;return!0}(n,t);default:return S()}}function Vr(n,t){return(n.values||[]).find(e=>jt(e,t))!==void 0}function me(n,t){if(n===t)return 0;let e=qe(n),r=qe(t);if(e!==r)return D(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return D(n.booleanValue,t.booleanValue);case 2:return function(s,o){let a=W(s.integerValue||s.doubleValue),u=W(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,t);case 3:return eh(n.timestampValue,t.timestampValue);case 4:return eh(Pr(n),Pr(t));case 5:return D(n.stringValue,t.stringValue);case 6:return function(s,o){let a=fe(s),u=fe(o);return a.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=D(a[c],u[c]);if(l!==0)return l}return D(a.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let a=D(W(s.latitude),W(o.latitude));return a!==0?a:D(W(s.longitude),W(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=me(a[c],u[c]);if(l)return l}return D(a.length,u.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===le.mapValue&&o===le.mapValue)return 0;if(s===le.mapValue)return 1;if(o===le.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=D(u[h],l[h]);if(d!==0)return d;let m=me(a[u[h]],c[l[h]]);if(m!==0)return m}return D(u.length,l.length)}(n.mapValue,t.mapValue);default:throw S()}}function eh(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return D(n,t);let e=Xt(n),r=Xt(t),i=D(e.seconds,r.seconds);return i!==0?i:D(e.nanos,r.nanos)}function Tn(n){return ea(n)}function ea(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Xt(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return fe(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return E.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",i=!0;for(let s of e.values||[])i?i=!1:r+=",",r+=ea(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${ea(e.fields[o])}`;return i+"}"}(n.mapValue):S()}function Ue(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function na(n){return!!n&&"integerValue"in n}function xr(n){return!!n&&"arrayValue"in n}function nh(n){return!!n&&"nullValue"in n}function rh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ki(n){return!!n&&"mapValue"in n}function wr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return He(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=wr(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=wr(n.arrayValue.values[e]);return t}return Object.assign({},n)}function cd(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function ng(n){return"nullValue"in n?Ni:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ue(In.empty(),E.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function rg(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ue(In.empty(),E.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?le:S()}function ih(n,t){let e=me(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function sh(n,t){let e=me(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var wt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!ki(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=wr(e)}setAll(t){let e=ot.emptyPath(),r={},i=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let u=this.getFieldsMap(e);this.applyChanges(u,r,i),r={},i=[],e=a.popLast()}o?r[a.lastSegment()]=wr(o):i.push(a.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){let e=this.field(t.popLast());ki(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return jt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];ki(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){He(e,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new n(wr(this.value))}};function ld(n){let t=[];return He(n.fields,(e,r)=>{let i=new ot([e]);if(ki(r)){let s=ld(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new Rt(t)}var it=class n{constructor(t,e,r,i,s,o,a){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,P.min(),P.min(),P.min(),wt.empty(),0)}static newFoundDocument(t,e,r,i){return new n(t,1,e,P.min(),r,i,0)}static newNoDocument(t,e){return new n(t,2,e,P.min(),P.min(),wt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,P.min(),P.min(),wt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(P.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=wt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=P.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var $t=class{constructor(t,e){this.position=t,this.inclusive=e}};function oh(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){let s=t[i],o=n.position[i];if(s.field.isKeyField()?r=E.comparator(E.fromName(o.referenceValue),e.key):r=me(o,e.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function ah(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!jt(n.position[e],t.position[e]))return!1;return!0}var Be=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function ig(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var ji=class{},k=class n extends ji{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new sa(t,e,r):e==="array-contains"?new ua(t,r):e==="in"?new $i(t,r):e==="not-in"?new ca(t,r):e==="array-contains-any"?new la(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new oa(t,r):new aa(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(me(e,this.value)):e!==null&&qe(this.value)===qe(e)&&this.matchesComparison(me(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},U=class n extends ji{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new n(t,e)}matches(t){return En(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function En(n){return n.op==="and"}function ra(n){return n.op==="or"}function Ku(n){return hd(n)&&En(n)}function hd(n){for(let t of n.filters)if(t instanceof U)return!1;return!0}function ia(n){if(n instanceof k)return n.field.canonicalString()+n.op.toString()+Tn(n.value);if(Ku(n))return n.filters.map(t=>ia(t)).join(",");{let t=n.filters.map(e=>ia(e)).join(",");return`${n.op}(${t})`}}function dd(n,t){return n instanceof k?function(r,i){return i instanceof k&&r.op===i.op&&r.field.isEqual(i.field)&&jt(r.value,i.value)}(n,t):n instanceof U?function(r,i){return i instanceof U&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&dd(o,i.filters[a]),!0):!1}(n,t):void S()}function fd(n,t){let e=n.filters.concat(t);return U.create(e,n.op)}function md(n){return n instanceof k?function(e){return`${e.field.canonicalString()} ${e.op} ${Tn(e.value)}`}(n):n instanceof U?function(e){return e.op.toString()+" {"+e.getFilters().map(md).join(" ,")+"}"}(n):"Filter"}var sa=class extends k{constructor(t,e,r){super(t,e,r),this.key=E.fromName(r.referenceValue)}matches(t){let e=E.comparator(t.key,this.key);return this.matchesComparison(e)}},oa=class extends k{constructor(t,e){super(t,"in",e),this.keys=gd("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},aa=class extends k{constructor(t,e){super(t,"not-in",e),this.keys=gd("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function gd(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>E.fromName(r.referenceValue))}var ua=class extends k{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return xr(e)&&Vr(e.arrayValue,this.value)}},$i=class extends k{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Vr(this.value.arrayValue,e)}},ca=class extends k{constructor(t,e){super(t,"not-in",e)}matches(t){if(Vr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Vr(this.value.arrayValue,e)}},la=class extends k{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!xr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Vr(this.value.arrayValue,r))}};var ha=class{constructor(t,e=null,r=[],i=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function da(n,t=null,e=[],r=[],i=null,s=null,o=null){return new ha(n,t,e,r,i,s,o)}function ze(n){let t=I(n);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>ia(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Qr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>Tn(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>Tn(r)).join(",")),t.ue=e}return t.ue}function Wr(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!ig(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!dd(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!ah(n.startAt,t.startAt)&&ah(n.endAt,t.endAt)}function Qi(n){return E.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Wi(n,t){return n.filters.filter(e=>e instanceof k&&e.field.isEqual(t))}function uh(n,t,e){let r=Ni,i=!0;for(let s of Wi(n,t)){let o=Ni,a=!0;switch(s.op){case"<":case"<=":o=ng(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ni}ih({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];ih({value:r,inclusive:i},{value:o,inclusive:e.inclusive})<0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}function ch(n,t,e){let r=le,i=!0;for(let s of Wi(n,t)){let o=le,a=!0;switch(s.op){case">=":case">":o=rg(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=le}sh({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];sh({value:r,inclusive:i},{value:o,inclusive:e.inclusive})>0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}var Ct=class{constructor(t,e=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function pd(n,t,e,r,i,s,o,a){return new Ct(n,t,e,r,i,s,o,a)}function On(n){return new Ct(n)}function lh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ju(n){return n.collectionGroup!==null}function pn(n){let t=I(n);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new B(ot.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new Be(s,r))}),e.has(ot.keyField().canonicalString())||t.ce.push(new Be(ot.keyField(),r))}return t.ce}function Tt(n){let t=I(n);return t.le||(t.le=sg(t,pn(n))),t.le}function sg(n,t){if(n.limitType==="F")return da(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Be(i.field,s)});let e=n.endAt?new $t(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new $t(n.startAt.position,n.startAt.inclusive):null;return da(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function fa(n,t){let e=n.filters.concat([t]);return new Ct(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Hi(n,t,e){return new Ct(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Hr(n,t){return Wr(Tt(n),Tt(t))&&n.limitType===t.limitType}function _d(n){return`${ze(Tt(n))}|lt:${n.limitType}`}function ln(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>md(i)).join(", ")}]`),Qr(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>Tn(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>Tn(i)).join(",")),`Target(${r})`}(Tt(n))}; limitType=${n.limitType})`}function Jr(n,t){return t.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):E.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,t)&&function(r,i){for(let s of pn(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,t)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,t)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=oh(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,pn(r),i)||r.endAt&&!function(o,a,u){let c=oh(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,pn(r),i))}(n,t)}function yd(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function wd(n){return(t,e)=>{let r=!1;for(let i of pn(n)){let s=og(i,t,e);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function og(n,t,e){let r=n.field.isKeyField()?E.comparator(t.key,e.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?me(u,c):S()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var Qt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){He(this.inner,(e,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return ud(this.inner)}size(){return this.innerSize}};var ag=new K(E.comparator);function Et(){return ag}var vd=new K(E.comparator);function _r(...n){let t=vd;for(let e of n)t=t.insert(e.key,e);return t}function Id(n){let t=vd;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Ut(){return vr()}function Td(){return vr()}function vr(){return new Qt(n=>n.toString(),(n,t)=>n.isEqual(t))}var ug=new K(E.comparator),cg=new B(E.comparator);function b(...n){let t=cg;for(let e of n)t=t.add(e);return t}var lg=new B(D);function $u(){return lg}function Ed(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Sr(t)?"-0":t}}function Ad(n){return{integerValue:""+n}}function Sd(n,t){return nd(t)?Ad(t):Ed(n,t)}var An=class{constructor(){this._=void 0}};function hg(n,t,e){return n instanceof ge?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ks(s)&&(s=Gu(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof Zt?Pd(n,t):n instanceof te?Vd(n,t):function(i,s){let o=Rd(i,s),a=hh(o)+hh(i.Pe);return na(o)&&na(i.Pe)?Ad(a):Ed(i.serializer,a)}(n,t)}function dg(n,t,e){return n instanceof Zt?Pd(n,t):n instanceof te?Vd(n,t):e}function Rd(n,t){return n instanceof pe?function(r){return na(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}var ge=class extends An{},Zt=class extends An{constructor(t){super(),this.elements=t}};function Pd(n,t){let e=xd(t);for(let r of n.elements)e.some(i=>jt(i,r))||e.push(r);return{arrayValue:{values:e}}}var te=class extends An{constructor(t){super(),this.elements=t}};function Vd(n,t){let e=xd(t);for(let r of n.elements)e=e.filter(i=>!jt(i,r));return{arrayValue:{values:e}}}var pe=class extends An{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function hh(n){return W(n.integerValue||n.doubleValue)}function xd(n){return xr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Ge=class{constructor(t,e){this.field=t,this.transform=e}};function fg(n,t){return n.field.isEqual(t.field)&&function(r,i){return r instanceof Zt&&i instanceof Zt||r instanceof te&&i instanceof te?wn(r.elements,i.elements,jt):r instanceof pe&&i instanceof pe?jt(r.Pe,i.Pe):r instanceof ge&&i instanceof ge}(n.transform,t.transform)}var ma=class{constructor(t,e){this.version=t,this.transformResults=e}},H=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Fi(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Sn=class{};function Dd(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new ye(n.key,H.none()):new _e(n.key,n.data,H.none());{let e=n.data,r=wt.empty(),i=new B(ot.comparator);for(let s of t.fields)if(!i.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Nt(n.key,r,new Rt(i.toArray()),H.none())}}function mg(n,t,e){n instanceof _e?function(i,s,o){let a=i.value.clone(),u=fh(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof Nt?function(i,s,o){if(!Fi(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=fh(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(bd(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function Ir(n,t,e,r){return n instanceof _e?function(s,o,a,u){if(!Fi(s.precondition,o))return a;let c=s.value.clone(),l=mh(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,t,e,r):n instanceof Nt?function(s,o,a,u){if(!Fi(s.precondition,o))return a;let c=mh(s.fieldTransforms,u,o),l=o.data;return l.setAll(bd(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,r):function(s,o,a){return Fi(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function gg(n,t){let e=null;for(let r of n.fieldTransforms){let i=t.data.field(r.field),s=Rd(r.transform,i||null);s!=null&&(e===null&&(e=wt.empty()),e.set(r.field,s))}return e||null}function dh(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&wn(r,i,(s,o)=>fg(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var _e=class extends Sn{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Nt=class extends Sn{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function bd(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function fh(n,t,e){let r=new Map;R(n.length===e.length);for(let i=0;i<e.length;i++){let s=n[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,dg(o,a,e[i]))}return r}function mh(n,t,e){let r=new Map;for(let i of n){let s=i.transform,o=e.data.field(i.field);r.set(i.field,hg(s,o,t))}return r}var ye=class extends Sn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Dr=class extends Sn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var br=class{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&mg(s,t,r[i])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=Ir(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=Ir(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=Td();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=e.has(i.key)?null:a;let u=Dd(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(P.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),b())}isEqual(t){return this.batchId===t.batchId&&wn(this.mutations,t.mutations,(e,r)=>dh(e,r))&&wn(this.baseMutations,t.baseMutations,(e,r)=>dh(e,r))}},ga=class n{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){R(t.mutations.length===r.length);let i=function(){return ug}(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(t,e,r,i)}};var Cr=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var pa=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var tt,F;function Cd(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function Nd(n){if(n===void 0)return J("GRPC error has no .code"),g.UNKNOWN;switch(n){case tt.OK:return g.OK;case tt.CANCELLED:return g.CANCELLED;case tt.UNKNOWN:return g.UNKNOWN;case tt.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case tt.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case tt.INTERNAL:return g.INTERNAL;case tt.UNAVAILABLE:return g.UNAVAILABLE;case tt.UNAUTHENTICATED:return g.UNAUTHENTICATED;case tt.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case tt.NOT_FOUND:return g.NOT_FOUND;case tt.ALREADY_EXISTS:return g.ALREADY_EXISTS;case tt.PERMISSION_DENIED:return g.PERMISSION_DENIED;case tt.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case tt.ABORTED:return g.ABORTED;case tt.OUT_OF_RANGE:return g.OUT_OF_RANGE;case tt.UNIMPLEMENTED:return g.UNIMPLEMENTED;case tt.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(F=tt||(tt={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";var gh=null;function kd(){return new TextEncoder}var pg=new De([4294967295,4294967295],0);function ph(n){let t=kd().encode(n),e=new Hl;return e.update(t),new Uint8Array(e.digest())}function _h(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new De([e,r],0),new De([i,s],0)]}var _a=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new Le(`Invalid padding: ${e}`);if(r<0)throw new Le(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new Le(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new Le(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=De.fromNumber(this.Ie)}Ee(t,e,r){let i=t.add(e.multiply(De.fromNumber(r)));return i.compare(pg)===1&&(i=new De([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=ph(t),[r,i]=_h(e);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(t,e,r){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,i,e);return r.forEach(a=>o.insert(a)),o}insert(t){if(this.Ie===0)return;let e=ph(t),[r,i]=_h(e);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},Le=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Nr=class n{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let i=new Map;return i.set(t,kr.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(P.min(),i,new K(D),Et(),b())}},kr=class n{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,b(),b(),b())}};var _n=class{constructor(t,e,r,i){this.Re=t,this.removedTargetIds=e,this.key=r,this.Ve=i}},Ji=class{constructor(t,e){this.targetId=t,this.me=e}},Yi=class{constructor(t,e,r=lt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}},Xi=class{constructor(){this.fe=0,this.ge=wh(),this.pe=lt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=b(),e=b(),r=b();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:S()}}),new kr(this.pe,this.ye,t,e,r)}ve(){this.we=!1,this.ge=wh()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,R(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},ya=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Et(),this.qe=yh(),this.Qe=new K(D)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let r=this.Ge(e);switch(t.state){case 0:this.ze(e)&&r.De(t.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(t.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(r.Ne(),r.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),r.De(t.resumeToken));break;default:S()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((r,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,r=t.me.count,i=this.Je(e);if(i){let s=i.target;if(Qi(s))if(r===0){let o=new E(s.path);this.Ue(e,o,it.newNoDocument(o,P.min()))}else R(r===1);else{let o=this.Ye(e);if(o!==r){let a=this.Ze(t),u=a?this.Xe(a,t,o):1;if(u!==0){this.je(e);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,c)}gh?.et(function(l,h,d,m,A){var w,v,x,N,C,z;let j={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},O=h.unchangedNames;return O&&(j.bloomFilter={applied:A===0,hashCount:(w=O?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(N=(x=(v=O?.bits)===null||v===void 0?void 0:v.bitmap)===null||x===void 0?void 0:x.length)!==null&&N!==void 0?N:0,padding:(z=(C=O?.bits)===null||C===void 0?void 0:C.padding)!==null&&z!==void 0?z:0,mightContain:at=>{var kt;return(kt=m?.mightContain(at))!==null&&kt!==void 0&&kt}}),j}(o,t.me,this.Le.tt(),a,u))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e,o,a;try{o=fe(r).toUint8Array()}catch(u){if(u instanceof Ki)return Kt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new _a(o,i,s)}catch(u){return Kt(u instanceof Le?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(t,e,r){return e.me.count===r-this.nt(t,e.targetId)?0:2}nt(t,e){let r=this.Le.getRemoteKeysForTarget(e),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Qi(a.target)){let u=new E(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,it.newNoDocument(u,t))}s.be&&(e.set(o,s.Ce()),s.ve())}});let r=b();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(t));let i=new Nr(t,e,this.Qe,this.ke,r);return this.ke=Et(),this.qe=yh(),this.Qe=new K(D),i}$e(t,e){if(!this.ze(t))return;let r=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,r),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,r){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),r&&(this.ke=this.ke.insert(e,r))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new Xi,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new B(D),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||_("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Xi),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function yh(){return new K(E.comparator)}function wh(){return new K(E.comparator)}var _g={asc:"ASCENDING",desc:"DESCENDING"},yg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wg={and:"AND",or:"OR"},wa=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function va(n,t){return n.useProto3Json||Qr(t)?t:{value:t}}function Rn(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Fd(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function vg(n,t){return Rn(n,t.toTimestamp())}function X(n){return R(!!n),P.fromTimestamp(function(e){let r=Xt(e);return new Y(r.seconds,r.nanos)}(n))}function Qu(n,t){return Ia(n,t).canonicalString()}function Ia(n,t){let e=function(i){return new M(["projects",i.projectId,"databases",i.database])}(n).child("documents");return t===void 0?e:e.child(t)}function Md(n){let t=M.fromString(n);return R($d(t)),t}function Fr(n,t){return Qu(n.databaseId,t.path)}function zt(n,t){let e=Md(t);if(e.get(1)!==n.databaseId.projectId)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new E(qd(e))}function Ld(n,t){return Qu(n.databaseId,t)}function Od(n){let t=Md(n);return t.length===4?M.emptyPath():qd(t)}function Ta(n){return new M(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function qd(n){return R(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function vh(n,t,e){return{name:Fr(n,t),fields:e.value.mapValue.fields}}function Ud(n,t,e){let r=zt(n,t.name),i=X(t.updateTime),s=t.createTime?X(t.createTime):P.min(),o=new wt({mapValue:{fields:t.fields}}),a=it.newFoundDocument(r,i,s,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function Ig(n,t){return"found"in t?function(r,i){R(!!i.found),i.found.name,i.found.updateTime;let s=zt(r,i.found.name),o=X(i.found.updateTime),a=i.found.createTime?X(i.found.createTime):P.min(),u=new wt({mapValue:{fields:i.found.fields}});return it.newFoundDocument(s,o,a,u)}(n,t):"missing"in t?function(r,i){R(!!i.missing),R(!!i.readTime);let s=zt(r,i.missing),o=X(i.readTime);return it.newNoDocument(s,o)}(n,t):S()}function Tg(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(R(l===void 0||typeof l=="string"),lt.fromBase64String(l||"")):(R(l===void 0||l instanceof Buffer||l instanceof Uint8Array),lt.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:Nd(c.code);return new y(l,c.message||"")}(o);e=new Yi(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=zt(n,r.document.name),s=X(r.document.updateTime),o=r.document.createTime?X(r.document.createTime):P.min(),a=new wt({mapValue:{fields:r.document.fields}}),u=it.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];e=new _n(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=zt(n,r.document),s=r.readTime?X(r.readTime):P.min(),o=it.newNoDocument(i,s),a=r.removedTargetIds||[];e=new _n([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=zt(n,r.document),s=r.removedTargetIds||[];e=new _n([],s,i,null)}else{if(!("filter"in t))return S();{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new pa(i,s),a=r.targetId;e=new Ji(a,o)}}return e}function Mr(n,t){let e;if(t instanceof _e)e={update:vh(n,t.key,t.value)};else if(t instanceof ye)e={delete:Fr(n,t.key)};else if(t instanceof Nt)e={update:vh(n,t.key,t.data),updateMask:Vg(t.fieldMask)};else{if(!(t instanceof Dr))return S();e={verify:Fr(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof ge)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Zt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof te)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof pe)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw S()}(0,r))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:vg(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,t.precondition)),e}function Ea(n,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?H.updateTime(X(s.updateTime)):s.exists!==void 0?H.exists(s.exists):H.none()}(t.currentDocument):H.none(),r=t.updateTransforms?t.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)R(a.setToServerValue==="REQUEST_TIME"),u=new ge;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new Zt(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new te(l)}else"increment"in a?u=new pe(o,a.increment):S();let c=ot.fromServerFormat(a.fieldPath);return new Ge(c,u)}(n,i)):[];if(t.update){t.update.name;let i=zt(n,t.update.name),s=new wt({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Rt(c.map(l=>ot.fromServerFormat(l)))}(t.updateMask);return new Nt(i,s,o,e,r)}return new _e(i,s,e,r)}if(t.delete){let i=zt(n,t.delete);return new ye(i,e)}if(t.verify){let i=zt(n,t.verify);return new Dr(i,e)}return S()}function Eg(n,t){return n&&n.length>0?(R(t!==void 0),n.map(e=>function(i,s){let o=i.updateTime?X(i.updateTime):X(s);return o.isEqual(P.min())&&(o=X(s)),new ma(o,i.transformResults||[])}(e,t))):[]}function Bd(n,t){return{documents:[Ld(n,t.path)]}}function zd(n,t){let e={structuredQuery:{}},r=t.path,i;t.collectionGroup!==null?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Ld(n,i);let s=function(c){if(c.length!==0)return jd(U.create(c,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:hn(d.field),direction:Sg(d.dir)}}(l))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);let a=va(n,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),{_t:e,parent:i}}function Gd(n){let t=Od(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,i=null;if(r>0){R(r===1);let l=e.from[0];l.allDescendants?i=l.collectionId:t=t.child(l.collectionId)}let s=[];e.where&&(s=function(h){let d=Kd(h);return d instanceof U&&Ku(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(A){return new Be(dn(A.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Qr(d)?null:d}(e.limit));let u=null;e.startAt&&(u=function(h){let d=!!h.before,m=h.values||[];return new $t(m,d)}(e.startAt));let c=null;return e.endAt&&(c=function(h){let d=!h.before,m=h.values||[];return new $t(m,d)}(e.endAt)),pd(t,i,o,s,a,"F",u,c)}function Ag(n,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Kd(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=dn(e.unaryFilter.field);return k.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=dn(e.unaryFilter.field);return k.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=dn(e.unaryFilter.field);return k.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=dn(e.unaryFilter.field);return k.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(e){return k.create(dn(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return U.create(e.compositeFilter.filters.map(r=>Kd(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(e.compositeFilter.op))}(n):S()}function Sg(n){return _g[n]}function Rg(n){return yg[n]}function Pg(n){return wg[n]}function hn(n){return{fieldPath:n.canonicalString()}}function dn(n){return ot.fromServerFormat(n.fieldPath)}function jd(n){return n instanceof k?function(e){if(e.op==="=="){if(rh(e.value))return{unaryFilter:{field:hn(e.field),op:"IS_NAN"}};if(nh(e.value))return{unaryFilter:{field:hn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(rh(e.value))return{unaryFilter:{field:hn(e.field),op:"IS_NOT_NAN"}};if(nh(e.value))return{unaryFilter:{field:hn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hn(e.field),op:Rg(e.op),value:e.value}}}(n):n instanceof U?function(e){let r=e.getFilters().map(i=>jd(i));return r.length===1?r[0]:{compositeFilter:{op:Pg(e.op),filters:r}}}(n):S()}function Vg(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function $d(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Pn=class n{constructor(t,e,r,i,s=P.min(),o=P.min(),a=lt.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Zi=class{constructor(t){this.ut=t}};function xg(n,t){let e;if(t.document)e=Ud(n.ut,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let r=E.fromSegments(t.noDocument.path),i=je(t.noDocument.readTime);e=it.newNoDocument(r,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return S();{let r=E.fromSegments(t.unknownDocument.path),i=je(t.unknownDocument.version);e=it.newUnknownDocument(r,i)}}return t.readTime&&e.setReadTime(function(i){let s=new Y(i[0],i[1]);return P.fromTimestamp(s)}(t.readTime)),e}function Ih(n,t){let e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:ts(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(s,o){return{name:Fr(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Rn(s,o.version.toTimestamp()),createTime:Rn(s,o.createTime.toTimestamp())}}(n.ut,t);else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:Ke(t.version)};else{if(!t.isUnknownDocument())return S();r.unknownDocument={path:e.path.toArray(),version:Ke(t.version)}}return r}function ts(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function Ke(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function je(n){let t=new Y(n.seconds,n.nanoseconds);return P.fromTimestamp(t)}function ke(n,t){let e=(t.baseMutations||[]).map(s=>Ea(n.ut,s));for(let s=0;s<t.mutations.length-1;++s){let o=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let a=t.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let r=t.mutations.map(s=>Ea(n.ut,s)),i=Y.fromMillis(t.localWriteTimeMs);return new br(t.batchId,i,e,r)}function yr(n){let t=je(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?je(n.lastLimboFreeSnapshotVersion):P.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return R(s.documents.length===1),Tt(On(Od(s.documents[0])))}(n.query):function(s){return Tt(Gd(s))}(n.query),new Pn(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,lt.fromBase64String(n.resumeToken))}function Qd(n,t){let e=Ke(t.snapshotVersion),r=Ke(t.lastLimboFreeSnapshotVersion),i;i=Qi(t.target)?Bd(n.ut,t.target):zd(n.ut,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ze(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Wu(n){let t=Gd({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Hi(t,t.limit,"L"):t}function Oo(n,t){return new Cr(t.largestBatchId,Ea(n.ut,t.overlayMutation))}function Th(n,t){let e=t.path.lastSegment();return[n,It(t.path.popLast()),e]}function Eh(n,t,e,r){return{indexId:n,uid:t,sequenceNumber:e,readTime:Ke(r.readTime),documentKey:It(r.documentKey.path),largestBatchId:r.largestBatchId}}var Aa=class{getBundleMetadata(t,e){return Ah(t).get(e).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:je(s.createTime),version:s.version}}(r)})}saveBundleMetadata(t,e){return Ah(t).put(function(i){return{bundleId:i.id,createTime:Ke(X(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return Sh(t).get(e).next(r=>{if(r)return function(s){return{name:s.name,query:Wu(s.bundledQuery),readTime:je(s.readTime)}}(r)})}saveNamedQuery(t,e){return Sh(t).put(function(i){return{name:i.name,readTime:Ke(X(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function Ah(n){return ht(n,"bundles")}function Sh(n){return ht(n,"namedQueries")}var es=class n{constructor(t,e){this.serializer=t,this.userId=e}static ct(t,e){let r=e.uid||"";return new n(t,r)}getOverlay(t,e){return fr(t).get(Th(this.userId,e)).next(r=>r?Oo(this.serializer,r):null)}getOverlays(t,e){let r=Ut();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){let i=[];return r.forEach((s,o)=>{let a=new Cr(e,o);i.push(this.lt(t,a))}),f.waitFor(i)}removeOverlaysForBatchId(t,e,r){let i=new Set;e.forEach(o=>i.add(It(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(fr(t).j("collectionPathOverlayIndex",a))}),f.waitFor(s)}getOverlaysForCollection(t,e,r){let i=Ut(),s=It(e),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return fr(t).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Oo(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(t,e,r,i){let s=Ut(),o,a=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return fr(t).J({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=Oo(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(t,e){return fr(t).put(function(i,s,o){let[a,u,c]=Th(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Mr(i.ut,o.mutation)}}(this.serializer,this.userId,e))}};function fr(n){return ht(n,"documentOverlays")}var Jt=class{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(W(t.integerValue));else if("doubleValue"in t){let r=W(t.doubleValue);isNaN(r)?this.Tt(e,13):(this.Tt(e,15),Sr(r)?e.Et(0):e.Et(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Tt(e,20),typeof r=="string"&&(r=Xt(r)),e.dt(`${r.seconds||""}`),e.Et(r.nanos||0)}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(fe(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Tt(e,45),e.Et(r.latitude||0),e.Et(r.longitude||0)}else"mapValue"in t?cd(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):S()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){let r=t.fields||{};this.Tt(e,55);for(let i of Object.keys(r))this.At(i,e),this.Pt(r[i],e)}yt(t,e){let r=t.values||[];this.Tt(e,50);for(let i of r)this.Pt(i,e)}ft(t,e){this.Tt(e,37),E.fromName(t).path.forEach(r=>{this.Tt(e,60),this.wt(r,e)})}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}};Jt.St=new Jt;function Dg(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function Rh(n){let t=64-function(r){let i=0;for(let s=0;s<8;++s){let o=Dg(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(t/8)}var Sa=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Dt(r.value),r=e.next();this.Ct()}vt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Ft(r.value),r=e.next();this.Mt()}xt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{let i=e.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=e.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(t){let e=this.Lt(t),r=Rh(e);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=255&e[i]}kt(t){let e=this.Lt(t),r=Rh(e);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(t){this.Bt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ut(){return this.buffer.slice(0,this.position)}Lt(t){let e=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(t),r=(128&e[0])!=0;e[0]^=r?255:128;for(let i=1;i<e.length;++i)e[i]^=r?255:0;return e}Dt(t){let e=255&t;e===0?(this.Qt(0),this.Qt(255)):e===255?(this.Qt(255),this.Qt(0)):this.Qt(e)}Ft(t){let e=255&t;e===0?(this.$t(0),this.$t(255)):e===255?(this.$t(255),this.$t(0)):this.$t(t)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(t){this.Bt(1),this.buffer[this.position++]=t}$t(t){this.Bt(1),this.buffer[this.position++]=~t}Bt(t){let e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Ra=class{constructor(t){this.Wt=t}Vt(t){this.Wt.bt(t)}dt(t){this.Wt.xt(t)}Et(t){this.Wt.Nt(t)}It(){this.Wt.qt()}},Pa=class{constructor(t){this.Wt=t}Vt(t){this.Wt.vt(t)}dt(t){this.Wt.Ot(t)}Et(t){this.Wt.kt(t)}It(){this.Wt.Kt()}},Fe=class{constructor(){this.Wt=new Sa,this.Gt=new Ra(this.Wt),this.zt=new Pa(this.Wt)}seed(t){this.Wt.seed(t)}jt(t){return t===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}};var Me=class n{constructor(t,e,r,i){this.indexId=t,this.documentKey=e,this.arrayValue=r,this.directionalValue=i}Ht(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,r=new Uint8Array(e);return r.set(this.directionalValue,0),e!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function oe(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=Ph(n.arrayValue,t.arrayValue),e!==0?e:(e=Ph(n.directionalValue,t.directionalValue),e!==0?e:E.comparator(n.documentKey,t.documentKey)))}function Ph(n,t){for(let e=0;e<n.length&&e<t.length;++e){let r=n[e]-t[e];if(r!==0)return r}return n.length-t.length}var ns=class{constructor(t){this.Jt=new B((e,r)=>ot.comparator(e.field,r.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Yt=t.orderBy,this.Zt=[];for(let e of t.filters){let r=e;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(t){if(R(t.collectionGroup===this.collectionId),this.Xt)return!1;let e=Ho(t);if(e!==void 0&&!this.tn(e))return!1;let r=Ce(t),i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){let a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Yt.length||!this.rn(this.Yt[o++],a))return!1}return!0}sn(){if(this.Xt)return null;let t=new B(ot.comparator),e=[];for(let r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")e.push(new gn(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new gn(r.field,0))}for(let r of this.Yt)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new gn(r.field,r.dir==="asc"?0:1)));return new vn(vn.UNKNOWN_ID,this.collectionId,e,Ar.empty())}tn(t){for(let e of this.Zt)if(this.nn(e,t))return!0;return!1}nn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let r=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===r}rn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Wd(n){var t,e;if(R(n instanceof k||n instanceof U),n instanceof k){if(n instanceof $i){let i=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>k.create(n.field,"==",s)))||[];return U.create(i,"or")}return n}let r=n.filters.map(i=>Wd(i));return U.create(r,n.op)}function bg(n){if(n.getFilters().length===0)return[];let t=Da(Wd(n));return R(Hd(t)),Va(t)||xa(t)?[t]:t.getFilters()}function Va(n){return n instanceof k}function xa(n){return n instanceof U&&Ku(n)}function Hd(n){return Va(n)||xa(n)||function(e){if(e instanceof U&&ra(e)){for(let r of e.getFilters())if(!Va(r)&&!xa(r))return!1;return!0}return!1}(n)}function Da(n){if(R(n instanceof k||n instanceof U),n instanceof k)return n;if(n.filters.length===1)return Da(n.filters[0]);let t=n.filters.map(r=>Da(r)),e=U.create(t,n.op);return e=rs(e),Hd(e)?e:(R(e instanceof U),R(En(e)),R(e.filters.length>1),e.filters.reduce((r,i)=>Hu(r,i)))}function Hu(n,t){let e;return R(n instanceof k||n instanceof U),R(t instanceof k||t instanceof U),e=n instanceof k?t instanceof k?function(i,s){return U.create([i,s],"and")}(n,t):Vh(n,t):t instanceof k?Vh(t,n):function(i,s){if(R(i.filters.length>0&&s.filters.length>0),En(i)&&En(s))return fd(i,s.getFilters());let o=ra(i)?i:s,a=ra(i)?s:i,u=o.filters.map(c=>Hu(c,a));return U.create(u,"or")}(n,t),rs(e)}function Vh(n,t){if(En(t))return fd(t,n.getFilters());{let e=t.filters.map(r=>Hu(n,r));return U.create(e,"or")}}function rs(n){if(R(n instanceof k||n instanceof U),n instanceof k)return n;let t=n.getFilters();if(t.length===1)return rs(t[0]);if(hd(n))return n;let e=t.map(i=>rs(i)),r=[];return e.forEach(i=>{i instanceof k?r.push(i):i instanceof U&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:U.create(r,n.op)}var ba=class{constructor(){this.on=new Lr}addToCollectionParentIndex(t,e){return this.on.add(e),f.resolve()}getCollectionParents(t,e){return f.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return f.resolve()}deleteFieldIndex(t,e){return f.resolve()}deleteAllFieldIndexes(t){return f.resolve()}createTargetIndexes(t,e){return f.resolve()}getDocumentsMatchingTarget(t,e){return f.resolve(null)}getIndexType(t,e){return f.resolve(0)}getFieldIndexes(t,e){return f.resolve([])}getNextCollectionGroupToUpdate(t){return f.resolve(null)}getMinOffset(t,e){return f.resolve(xt.min())}getMinOffsetFromCollectionGroup(t,e){return f.resolve(xt.min())}updateCollectionGroup(t,e,r){return f.resolve()}updateIndexEntries(t,e){return f.resolve()}},Lr=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new B(M.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new B(M.comparator)).toArray()}};var Vi=new Uint8Array(0),Ca=class{constructor(t,e){this.databaseId=e,this._n=new Lr,this.an=new Qt(r=>ze(r),(r,i)=>Wr(r,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this._n.has(e)){let r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this._n.add(e)});let s={collectionId:r,parent:It(i)};return xh(t).put(s)}return f.resolve()}getCollectionParents(t,e){let r=[],i=IDBKeyRange.bound([e,""],[Yh(e),""],!1,!0);return xh(t).U(i).next(s=>{for(let o of s){if(o.collectionId!==e)break;r.push(qt(o.parent))}return r})}addFieldIndex(t,e){let r=mr(t),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(e);delete i.indexId;let s=r.add(i);if(e.indexState){let o=an(t);return s.next(a=>{o.put(Eh(a,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let r=mr(t),i=an(t),s=on(t);return r.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=mr(t),r=on(t),i=an(t);return e.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(t,e){return f.forEach(this.un(e),r=>this.getIndexType(t,r).next(i=>{if(i===0||i===1){let s=new ns(r).sn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let r=on(t),i=!0,s=new Map;return f.forEach(this.un(e),o=>this.cn(t,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=b(),a=[];return f.forEach(s,(u,c)=>{_("IndexedDbIndexManager",`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(u)} to execute ${ze(e)}`);let l=function(C,z){let j=Ho(z);if(j===void 0)return null;for(let O of Wi(C,j.fieldPath))switch(O.op){case"array-contains-any":return O.value.arrayValue.values||[];case"array-contains":return[O.value]}return null}(c,u),h=function(C,z){let j=new Map;for(let O of Ce(z))for(let at of Wi(C,O.fieldPath))switch(at.op){case"==":case"in":j.set(O.fieldPath.canonicalString(),at.value);break;case"not-in":case"!=":return j.set(O.fieldPath.canonicalString(),at.value),Array.from(j.values())}return null}(c,u),d=function(C,z){let j=[],O=!0;for(let at of Ce(z)){let kt=at.kind===0?uh(C,at.fieldPath,C.startAt):ch(C,at.fieldPath,C.startAt);j.push(kt.value),O&&(O=kt.inclusive)}return new $t(j,O)}(c,u),m=function(C,z){let j=[],O=!0;for(let at of Ce(z)){let kt=at.kind===0?ch(C,at.fieldPath,C.endAt):uh(C,at.fieldPath,C.endAt);j.push(kt.value),O&&(O=kt.inclusive)}return new $t(j,O)}(c,u),A=this.ln(u,c,d),w=this.ln(u,c,m),v=this.hn(u,c,h),x=this.Pn(u.indexId,l,A,d.inclusive,w,m.inclusive,v);return f.forEach(x,N=>r.G(N,e.limit).next(C=>{C.forEach(z=>{let j=E.fromSegments(z.documentKey);o.has(j)||(o=o.add(j),a.push(j))})}))}).next(()=>a)}return f.resolve(null)})}un(t){let e=this.an.get(t);return e||(t.filters.length===0?e=[t]:e=bg(U.create(t.filters,"and")).map(r=>da(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.an.set(t,e),e)}Pn(t,e,r,i,s,o,a){let u=(e!=null?e.length:1)*Math.max(r.length,s.length),c=u/(e!=null?e.length:1),l=[];for(let h=0;h<u;++h){let d=e?this.In(e[h/c]):Vi,m=this.Tn(t,d,r[h%c],i),A=this.En(t,d,s[h%c],o),w=a.map(v=>this.Tn(t,d,v,!0));l.push(...this.createRange(m,A,w))}return l}Tn(t,e,r,i){let s=new Me(t,E.empty(),e,r);return i?s:s.Ht()}En(t,e,r,i){let s=new Me(t,E.empty(),e,r);return i?s.Ht():s}cn(t,e){let r=new ns(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let o=null;for(let a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let r=2,i=this.un(e);return f.forEach(i,s=>this.cn(t,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new B(ot.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(e)&&i.length>1&&r===2?1:r)}dn(t,e){let r=new Fe;for(let i of Ce(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let o=r.jt(i.kind);Jt.St.ht(s,o)}return r.Ut()}In(t){let e=new Fe;return Jt.St.ht(t,e.jt(0)),e.Ut()}An(t,e){let r=new Fe;return Jt.St.ht(Ue(this.databaseId,e),r.jt(function(s){let o=Ce(s);return o.length===0?0:o[o.length-1].kind}(t))),r.Ut()}hn(t,e,r){if(r===null)return[];let i=[];i.push(new Fe);let s=0;for(let o of Ce(t)){let a=r[s++];for(let u of i)if(this.Rn(e,o.fieldPath)&&xr(a))i=this.Vn(i,o,a);else{let c=u.jt(o.kind);Jt.St.ht(a,c)}}return this.mn(i)}ln(t,e,r){return this.hn(t,e,r.position)}mn(t){let e=[];for(let r=0;r<t.length;++r)e[r]=t[r].Ut();return e}Vn(t,e,r){let i=[...t],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new Fe;u.seed(a.Ut()),Jt.St.ht(o,u.jt(e.kind)),s.push(u)}return s}Rn(t,e){return!!t.filters.find(r=>r instanceof k&&r.field.isEqual(e)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(t,e){let r=mr(t),i=an(t);return(e?r.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):r.U()).next(s=>{let o=[];return f.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new Ar(h.sequenceNumber,new xt(je(h.readTime),new E(qt(h.documentKey)),h.largestBatchId)):Ar.empty(),m=l.fields.map(([A,w])=>new gn(ot.fromServerFormat(A),w));return new vn(l.indexId,l.collectionGroup,m,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:D(r.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){let i=mr(t),s=an(t);return this.fn(t).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>f.forEach(a,u=>s.put(Eh(u.indexId,this.uid,o,r)))))}updateIndexEntries(t,e){let r=new Map;return f.forEach(e,(i,s)=>{let o=r.get(i.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(t,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),f.forEach(a,u=>this.gn(t,i,u).next(c=>{let l=this.pn(s,u);return c.isEqual(l)?f.resolve():this.yn(t,s,u,c,l)}))))})}wn(t,e,r,i){return on(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,e.key),documentKey:e.key.path.toArray()})}Sn(t,e,r,i){return on(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,e.key),e.key.path.toArray()])}gn(t,e,r){let i=on(t),s=new B(oe);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,e)])},(o,a)=>{s=s.add(new Me(r.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(t,e){let r=new B(oe),i=this.dn(e,t);if(i==null)return r;let s=Ho(e);if(s!=null){let o=t.data.field(s.fieldPath);if(xr(o))for(let a of o.arrayValue.values||[])r=r.add(new Me(e.indexId,t.key,this.In(a),i))}else r=r.add(new Me(e.indexId,t.key,Vi,i));return r}yn(t,e,r,i,s){_("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let o=[];return function(u,c,l,h,d){let m=u.getIterator(),A=c.getIterator(),w=sn(m),v=sn(A);for(;w||v;){let x=!1,N=!1;if(w&&v){let C=l(w,v);C<0?N=!0:C>0&&(x=!0)}else w!=null?N=!0:x=!0;x?(h(v),v=sn(A)):N?(d(w),w=sn(m)):(w=sn(m),v=sn(A))}}(i,s,oe,a=>{o.push(this.wn(t,e,r,a))},a=>{o.push(this.Sn(t,e,r,a))}),f.waitFor(o)}fn(t){let e=1;return an(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,a)=>oe(o,a)).filter((o,a,u)=>!a||oe(o,u[a-1])!==0);let i=[];i.push(t);for(let o of r){let a=oe(o,t),u=oe(o,e);if(a===0)i[0]=t.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(e);let s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Vi,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Vi,[]];s.push(IDBKeyRange.bound(a,u))}return s}bn(t,e){return oe(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Dh)}getMinOffset(t,e){return f.mapArray(this.un(e),r=>this.cn(t,r).next(i=>i||S())).next(Dh)}};function xh(n){return ht(n,"collectionParents")}function on(n){return ht(n,"indexEntries")}function mr(n){return ht(n,"indexConfiguration")}function an(n){return ht(n,"indexState")}function Dh(n){R(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Bu(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new xt(t.readTime,t.documentKey,e)}var bh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Vt=class n{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Jd(n,t,e){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(e.batchId),a=0,u=r.J({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{R(a===1)}));let c=[];for(let l of e.mutations){let h=rd(t,l.key.path,e.batchId);s.push(i.delete(h)),c.push(l.key)}return f.waitFor(s).next(()=>c)}function is(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw S();t=n.noDocument}return JSON.stringify(t).length}Vt.DEFAULT_COLLECTION_PERCENTILE=10,Vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vt.DEFAULT=new Vt(41943040,Vt.DEFAULT_COLLECTION_PERCENTILE,Vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vt.DISABLED=new Vt(-1,0,0);var ss=class n{constructor(t,e,r,i){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(t,e,r,i){R(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new n(s,e,r,i)}checkEmpty(t){let e=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ae(t).J({index:"userMutationsIndex",range:r},(i,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,i){let s=fn(t),o=ae(t);return o.add({}).next(a=>{R(typeof a=="number");let u=new br(a,e,r,i),c=function(m,A,w){let v=w.baseMutations.map(N=>Mr(m.ut,N)),x=w.mutations.map(N=>Mr(m.ut,N));return{userId:A,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:v,mutations:x}}(this.serializer,this.userId,u),l=[],h=new B((d,m)=>D(d.canonicalString(),m.canonicalString()));for(let d of i){let m=rd(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(m,Om))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(t,e){return ae(t).get(e).next(r=>r?(R(r.userId===this.userId),ke(this.serializer,r)):null)}Cn(t,e){return this.Dn[e]?f.resolve(this.Dn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){let i=r.keys();return this.Dn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return ae(t).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(R(a.batchId>=r),s=ke(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return ae(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ae(t).U("userMutationsIndex",e).next(r=>r.map(i=>ke(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let r=Ci(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return fn(t).J({range:i},(o,a,u)=>{let[c,l,h]=o,d=qt(l);if(c===this.userId&&e.path.isEqual(d))return ae(t).get(h).next(m=>{if(!m)throw S();R(m.userId===this.userId),s.push(ke(this.serializer,m))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new B(D),i=[];return e.forEach(s=>{let o=Ci(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=fn(t).J({range:a},(c,l,h)=>{let[d,m,A]=c,w=qt(m);d===this.userId&&s.path.isEqual(w)?r=r.add(A):h.done()});i.push(u)}),f.waitFor(i).next(()=>this.vn(t,r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=Ci(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new B(D);return fn(t).J({range:o},(u,c,l)=>{let[h,d,m]=u,A=qt(d);h===this.userId&&r.isPrefixOf(A)?A.length===i&&(a=a.add(m)):l.done()}).next(()=>this.vn(t,a))}vn(t,e){let r=[],i=[];return e.forEach(s=>{i.push(ae(t).get(s).next(o=>{if(o===null)throw S();R(o.userId===this.userId),r.push(ke(this.serializer,o))}))}),f.waitFor(i).next(()=>r)}removeMutationBatch(t,e){return Jd(t._e,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.Fn(e.batchId)}),f.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Fn(t){delete this.Dn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return f.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return fn(t).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=qt(s[1]);i.push(u)}else a.done()}).next(()=>{R(i.length===0)})})}containsKey(t,e){return Yd(t,this.userId,e)}Mn(t){return Xd(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Yd(n,t,e){let r=Ci(t,e.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return fn(n).J({range:s,H:!0},(a,u,c)=>{let[l,h,d]=a;l===t&&h===i&&(o=!0),c.done()}).next(()=>o)}function ae(n){return ht(n,"mutations")}function fn(n){return ht(n,"documentMutations")}function Xd(n){return ht(n,"mutationQueues")}var Vn=class n{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new n(0)}static Nn(){return new n(-1)}};var Na=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Ln(t).next(e=>{let r=new Vn(e.highestTargetId);return e.highestTargetId=r.next(),this.Bn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Ln(t).next(e=>P.fromTimestamp(new Y(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Ln(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.Ln(t).next(i=>(i.highestListenSequenceNumber=e,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.Bn(t,i)))}addTargetData(t,e){return this.kn(t,e).next(()=>this.Ln(t).next(r=>(r.targetCount+=1,this.qn(e,r),this.Bn(t,r))))}updateTargetData(t,e){return this.kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>un(t).delete(e.targetId)).next(()=>this.Ln(t)).next(r=>(R(r.targetCount>0),r.targetCount-=1,this.Bn(t,r)))}removeTargets(t,e,r){let i=0,s=[];return un(t).J((o,a)=>{let u=yr(a);u.sequenceNumber<=e&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(t,u)))}).next(()=>f.waitFor(s)).next(()=>i)}forEachTarget(t,e){return un(t).J((r,i)=>{let s=yr(i);e(s)})}Ln(t){return Ch(t).get("targetGlobalKey").next(e=>(R(e!==null),e))}Bn(t,e){return Ch(t).put("targetGlobalKey",e)}kn(t,e){return un(t).put(Qd(this.serializer,e))}qn(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.Ln(t).next(e=>e.targetCount)}getTargetData(t,e){let r=ze(e),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return un(t).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=yr(a);Wr(e,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(t,e,r){let i=[],s=ue(t);return e.forEach(o=>{let a=It(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(t,r,o))}),f.waitFor(i)}removeMatchingKeys(t,e,r){let i=ue(t);return f.forEach(e,s=>{let o=It(s.path);return f.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(t,r,s)])})}removeMatchingKeysForTargetId(t,e){let r=ue(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(t,e){let r=IDBKeyRange.bound([e],[e+1],!1,!0),i=ue(t),s=b();return i.J({range:r,H:!0},(o,a,u)=>{let c=qt(o[1]),l=new E(c);s=s.add(l)}).next(()=>s)}containsKey(t,e){let r=It(e.path),i=IDBKeyRange.bound([r],[Yh(r)],!1,!0),s=0;return ue(t).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(t,e){return un(t).get(e).next(r=>r?yr(r):null)}};function un(n){return ht(n,"targets")}function Ch(n){return ht(n,"targetGlobal")}function ue(n){return ht(n,"targetDocuments")}function Nh([n,t],[e,r]){let i=D(n,e);return i===0?D(t,r):i}var ka=class{constructor(t){this.Qn=t,this.buffer=new B(Nh),this.Kn=0}$n(){return++this.Kn}Un(t){let e=[t,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();Nh(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},Fa=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(t){_("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>p(this,null,function*(){this.Wn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ae(e)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Ee(e)}yield this.Gn(3e5)}))}},Ma=class{constructor(t,e){this.zn=t,this.params=e}calculateTargetCount(t,e){return this.zn.jn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return f.resolve(St.oe);let r=new ka(e);return this.zn.forEachTarget(t,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(t,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.zn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(_("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(bh)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),bh):this.Jn(t,e))}getCacheSize(t){return this.zn.getCacheSize(t)}Jn(t,e){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(t,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(t,r,e))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(h=>(c=Date.now(),cn()<=Ft.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function Cg(n,t){return new Ma(n,t)}var La=class{constructor(t,e){this.db=t,this.garbageCollector=Cg(this,e)}jn(t){let e=this.Yn(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}Yn(t){let e=0;return this.Hn(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Hn(t,e){return this.Zn(t,(r,i)=>e(i))}addReference(t,e,r){return xi(t,r)}removeReference(t,e,r){return xi(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return xi(t,e)}Xn(t,e){return function(i,s){let o=!1;return Xd(i).Y(a=>Yd(i,a,s).next(u=>(u&&(o=!0),f.resolve(!u)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Zn(t,(o,a)=>{if(a<=e){let u=this.Xn(t,o).next(c=>{if(!c)return s++,r.getEntry(t,o).next(()=>(r.removeEntry(o,P.min()),ue(t).delete(function(h){return[0,It(h.path)]}(o))))});i.push(u)}}).next(()=>f.waitFor(i)).next(()=>r.apply(t)).next(()=>s)}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return xi(t,e)}Zn(t,e){let r=ue(t),i,s=St.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==St.oe&&e(new E(qt(i)),s),s=c,i=u):s=St.oe}).next(()=>{s!==St.oe&&e(new E(qt(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function xi(n,t){return ue(n).put(function(r,i){return{targetId:0,path:It(r.path),sequenceNumber:i}}(t,n.currentSequenceNumber))}var os=class{constructor(){this.changes=new Qt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,it.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?f.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Oa=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return be(t).put(r)}removeEntry(t,e,r){return be(t).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ts(o),a[a.length-1]]}(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.er(t,r)))}getEntry(t,e){let r=it.newInvalidDocument(e);return be(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(gr(e))},(i,s)=>{r=this.tr(e,s)}).next(()=>r)}nr(t,e){let r={size:0,document:it.newInvalidDocument(e)};return be(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(gr(e))},(i,s)=>{r={document:this.tr(e,s),size:is(s)}}).next(()=>r)}getEntries(t,e){let r=Et();return this.rr(t,e,(i,s)=>{let o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(t,e){let r=Et(),i=new K(E.comparator);return this.rr(t,e,(s,o)=>{let a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,is(o))}).next(()=>({documents:r,sr:i}))}rr(t,e,r){if(e.isEmpty())return f.resolve();let i=new B(Mh);e.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(gr(i.first()),gr(i.last())),o=i.getIterator(),a=o.getNext();return be(t).J({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=E.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Mh(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.$(gr(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,i,s){let o=e.path,a=[o.popLast().toArray(),o.lastSegment(),ts(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return be(t).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Et();for(let h of c){let d=this.tr(E.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Jr(e,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(t,e,r,i){let s=Et(),o=Fh(e,r),a=Fh(e,xt.max());return be(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.tr(E.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(t){return new qa(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return kh(t).get("remoteDocumentGlobalKey").next(e=>(R(!!e),e))}er(t,e){return kh(t).put("remoteDocumentGlobalKey",e)}tr(t,e){if(e){let r=xg(this.serializer,e);if(!(r.isNoDocument()&&r.version.isEqual(P.min())))return r}return it.newInvalidDocument(t)}};function Zd(n){return new Oa(n)}var qa=class extends os{constructor(t,e){super(),this._r=t,this.trackRemovals=e,this.ar=new Qt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(t){let e=[],r=0,i=new B((s,o)=>D(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ar.get(s);if(e.push(this._r.removeEntry(t,s,a.readTime)),o.isValidDocument()){let u=Ih(this._r.serializer,o);i=i.add(s.path.popLast());let c=is(u);r+=c-a.size,e.push(this._r.addEntry(t,s,u))}else if(r-=a.size,this.trackRemovals){let u=Ih(this._r.serializer,o.convertToNoDocument(P.min()));e.push(this._r.addEntry(t,s,u))}}),i.forEach(s=>{e.push(this._r.indexManager.addToCollectionParentIndex(t,s))}),e.push(this._r.updateMetadata(t,r)),f.waitFor(e)}getFromCache(t,e){return this._r.nr(t,e).next(r=>(this.ar.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this._r.ir(t,e).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function kh(n){return ht(n,"remoteDocumentGlobal")}function be(n){return ht(n,"remoteDocumentsV14")}function gr(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Fh(n,t){let e=t.documentKey.path.toArray();return[n,ts(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Mh(n,t){let e=n.path.toArray(),r=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<r.length-2;++s)if(i=D(e[s],r[s]),i)return i;return i=D(e.length,r.length),i||(i=D(e[e.length-2],r[r.length-2]),i||D(e[e.length-1],r[r.length-1]))}var Ua=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var as=class{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(r!==null&&Ir(r.mutation,i,Rt.empty(),Y.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,b()).next(()=>r))}getLocalViewOfDocuments(t,e,r=b()){let i=Ut();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(s=>{let o=_r();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let r=Ut();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,b()))}populateOverlays(t,e,r){let i=[];return r.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,r,i){let s=Et(),o=vr(),a=function(){return vr()}();return e.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof Nt)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),Ir(l.mutation,c,l.mutation.getFieldMask(),Y.now())):o.set(c.key,Rt.empty())}),this.recalculateAndSaveOverlays(t,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),e.forEach((c,l)=>{var h;return a.set(c,new Ua(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let r=vr(),i=new K((o,a)=>o-a),s=b();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=e.get(u);if(c===null)return;let l=r.get(u)||Rt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||b()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=Td();l.forEach(d=>{if(!s.has(d)){let m=Dd(e.get(d),r.get(d));m!==null&&h.set(d,m),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return function(o){return E.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):ju(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):f.resolve(Ut()),a=-1,u=s;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?f.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(t,c,s)).next(()=>this.computeViews(t,u,c,b())).next(l=>({batchId:a,changes:Id(l)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new E(e)).next(r=>{let i=_r();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){let s=e.collectionGroup,o=_r();return this.indexManager.getCollectionParents(t,s).next(a=>f.forEach(a,u=>{let c=function(h,d){return new Ct(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,u.child(s));return this.getDocumentsMatchingCollectionQuery(t,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,it.newInvalidDocument(l)))});let a=_r();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&Ir(l.mutation,c,Rt.empty(),Y.now()),Jr(e,c)&&(a=a.insert(u,c))}),a})}};var Ba=class{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return f.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(i){return{id:i.id,version:i.version,createTime:X(i.createTime)}}(e)),f.resolve()}getNamedQuery(t,e){return f.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(i){return{name:i.name,query:Wu(i.bundledQuery),readTime:X(i.readTime)}}(e)),f.resolve()}};var za=class{constructor(){this.overlays=new K(E.comparator),this.lr=new Map}getOverlay(t,e){return f.resolve(this.overlays.get(e))}getOverlays(t,e){let r=Ut();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,s)=>{this.lt(t,e,s)}),f.resolve()}removeOverlaysForBatchId(t,e,r){let i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),f.resolve()}getOverlaysForCollection(t,e,r){let i=Ut(),s=e.length+1,o=new E(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!e.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return f.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new K((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===e&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=Ut(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=Ut(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return f.resolve(a)}lt(t,e,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Cr(e,r));let s=this.lr.get(e);s===void 0&&(s=b(),this.lr.set(e,s)),this.lr.set(e,s.add(r.key))}};var Or=class{constructor(){this.hr=new B(et.Pr),this.Ir=new B(et.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){let r=new et(t,e);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.dr(new et(t,e))}Ar(t,e){t.forEach(r=>this.removeReference(r,e))}Rr(t){let e=new E(new M([])),r=new et(e,t),i=new et(e,t+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(t=>this.dr(t))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){let e=new E(new M([])),r=new et(e,t),i=new et(e,t+1),s=b();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new et(t,0),r=this.hr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},et=class{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return E.comparator(t.key,e.key)||D(t.gr,e.gr)}static Tr(t,e){return D(t.gr,e.gr)||E.comparator(t.key,e.key)}};var Ga=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new B(et.Pr)}checkEmpty(t){return f.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new br(s,e,r,i);this.mutationQueue.push(o);for(let a of i)this.yr=this.yr.add(new et(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(t,e){return f.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=this.Sr(r),s=i<0?0:i;return f.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(t){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new et(e,0),i=new et(e,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{let a=this.wr(o.gr);s.push(a)}),f.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new B(D);return e.forEach(i=>{let s=new et(i,0),o=new et(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),f.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=r;E.isDocumentKey(s)||(s=s.child(""));let o=new et(new E(s),0),a=new B(D);return this.yr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),f.resolve(this.br(a))}br(t){let e=[];return t.forEach(r=>{let i=this.wr(r);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){R(this.Dr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return f.forEach(e.mutations,i=>{let s=new et(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.yr=r})}Fn(t){}containsKey(t,e){let r=new et(e,0),i=this.yr.firstAfterOrEqual(r);return f.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,f.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}wr(t){let e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Ka=class{constructor(t){this.Cr=t,this.docs=function(){return new K(E.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return f.resolve(r?r.document.mutableCopy():it.newInvalidDocument(e))}getEntries(t,e){let r=Et();return e.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():it.newInvalidDocument(i))}),f.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Et(),o=e.path,a=new E(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Bu(Zh(l),r)<=0||(i.has(l.key)||Jr(e,l))&&(s=s.insert(l.key,l.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(t,e,r,i){S()}vr(t,e){return f.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new ja(this)}getSize(t){return f.resolve(this.size)}},ja=class extends os{constructor(t){super(),this._r=t}applyChanges(t){let e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this._r.addEntry(t,i)):this._r.removeEntry(r)}),f.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}};var $a=class{constructor(t){this.persistence=t,this.Fr=new Qt(e=>ze(e),Wr),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Or,this.targetCount=0,this.Nr=Vn.On()}forEachTarget(t,e){return this.Fr.forEach((r,i)=>e(i)),f.resolve()}getLastRemoteSnapshotVersion(t){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return f.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Mr&&(this.Mr=e),f.resolve()}kn(t){this.Fr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Nr=new Vn(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,f.resolve()}updateTargetData(t,e){return this.kn(e),f.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,f.resolve()}removeTargets(t,e,r){let i=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=e&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),f.waitFor(s).next(()=>i)}getTargetCount(t){return f.resolve(this.targetCount)}getTargetData(t,e){let r=this.Fr.get(e)||null;return f.resolve(r)}addMatchingKeys(t,e,r){return this.Or.Er(e,r),f.resolve()}removeMatchingKeys(t,e,r){this.Or.Ar(e,r);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),f.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),f.resolve()}getMatchingKeysForTargetId(t,e){let r=this.Or.mr(e);return f.resolve(r)}containsKey(t,e){return f.resolve(this.Or.containsKey(e))}};var us=class{constructor(t,e){this.Lr={},this.overlays={},this.Br=new St(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new $a(this),this.indexManager=new ba,this.remoteDocumentCache=function(i){return new Ka(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new Zi(e),this.Kr=new Ba(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new za,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Lr[t.toKey()];return r||(r=new Ga(e,this.referenceDelegate),this.Lr[t.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,r){_("MemoryPersistence","Starting transaction:",t);let i=new Qa(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(t,e){return f.or(Object.values(this.Lr).map(r=>()=>r.containsKey(t,e)))}},Qa=class extends Bi{constructor(t){super(),this.currentSequenceNumber=t}},cs=class n{constructor(t){this.persistence=t,this.Gr=new Or,this.zr=null}static jr(t){return new n(t)}get Hr(){if(this.zr)return this.zr;throw S()}addReference(t,e,r){return this.Gr.addReference(r,e),this.Hr.delete(r.toString()),f.resolve()}removeReference(t,e,r){return this.Gr.removeReference(r,e),this.Hr.add(r.toString()),f.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),f.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach(i=>this.Hr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(t,e))}$r(){this.zr=new Set}Ur(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Hr,r=>{let i=E.fromPath(r);return this.Jr(t,i).next(s=>{s||e.removeEntry(i,P.min())})}).next(()=>(this.zr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Jr(t,e).next(r=>{r?this.Hr.delete(e.toString()):this.Hr.add(e.toString())})}Qr(t){return 0}Jr(t,e){return f.or([()=>f.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}};var Wa=class{constructor(t){this.serializer=t}O(t,e,r,i){let s=new zi("createOrUpgrade",e);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(t),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zl,{unique:!0}),u.createObjectStore("documentMutations")}(t),Lh(t),function(u){u.createObjectStore("remoteDocuments")}(t));let o=f.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(t),Lh(t)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:P.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zl,{unique:!0});let h=c.store("mutations"),d=l.map(m=>h.put(m));return f.waitFor(d)})}(t,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(t),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(t,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:Jm});c.createIndex("collectionPathOverlayIndex",Ym,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Xm,{unique:!1})})(t)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:qm});c.createIndex("documentKeyIndex",Um),c.createIndex("collectionGroupIndex",Bm)}(t)).next(()=>this.ri(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(t,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:$m}).createIndex("sequenceNumberIndex",Qm,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Wm}).createIndex("documentKeyIndex",Hm,{unique:!1})}(t))),r<16&&i>=16&&(o=o.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),o}Xr(t){let e=0;return t.store("remoteDocuments").J((r,i)=>{e+=is(i)}).next(()=>{let r={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(t){let e=t.store("mutationQueues"),r=t.store("mutations");return e.U().next(i=>f.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>f.forEach(a,u=>{R(u.userId===s.userId);let c=ke(this.serializer,u);return Jd(t,s.userId,c).next(()=>{})}))}))}ei(t){let e=t.store("targetDocuments"),r=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new M(o),c=function(h){return[0,It(h)]}(u);s.push(e.get(c).next(l=>l?f.resolve():(h=>e.put({targetId:0,path:It(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>f.waitFor(s))})}ti(t,e){t.createObjectStore("collectionParents",{keyPath:jm});let r=e.store("collectionParents"),i=new Lr,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:It(u)})}};return e.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new M(o);return s(u.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([o,a,u],c)=>{let l=qt(a);return s(l.popLast())}))}ni(t){let e=t.store("targets");return e.J((r,i)=>{let s=yr(i),o=Qd(this.serializer,s);return e.put(o)})}ri(t,e){let r=e.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=e.store("remoteDocumentsV14"),u=function(h){return h.document?new E(M.fromString(h.document.name).popFirst(5)):h.noDocument?E.fromSegments(h.noDocument.path):h.unknownDocument?E.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>f.waitFor(i))}ii(t,e){let r=e.store("mutations"),i=Zd(this.serializer),s=new us(cs.jr,this.serializer.ut);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:b();ke(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{let l=new nt(c),h=es.ct(this.serializer,l),d=s.getIndexManager(l),m=ss.ct(l,this.serializer,d,s.referenceDelegate);return new as(i,m,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Rr(e,St.oe),u).next()})})}};function Lh(n){n.createObjectStore("targetDocuments",{keyPath:Gm}).createIndex("documentTargetsIndex",Km,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",zm,{unique:!0}),n.createObjectStore("targetGlobal")}var qo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ha=class n{constructor(t,e,r,i,s,o,a,u,c,l,h=16){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=h,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!n.D())throw new y(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new La(this,i),this.Ii=e+"main",this.serializer=new Zi(u),this.Ti=new de(this.Ii,this.ai,new Wa(this.serializer)),this.qr=new Na(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Zd(this.serializer),this.Kr=new Aa,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,l===!1&&J("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,qo);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.qr.getHighestSequenceNumber(t))}).then(t=>{this.Br=new St(t,this.oi)}).then(()=>{this.kr=!0}).catch(t=>(this.Ti&&this.Ti.close(),Promise.reject(t)))}mi(t){return this.Pi=e=>p(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ti.L(e=>p(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.si.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Di(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(t)).next(e=>this.isPrimary&&!e?this.pi(t).next(()=>!1):!!e&&this.yi(t).next(()=>!0))).catch(t=>{if(Ae(t))return _("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.si.enqueueRetryable(()=>this.Pi(t)),this.isPrimary=t})}fi(t){return pr(t).get("owner").next(e=>f.resolve(this.wi(e)))}Si(t){return Di(t).delete(this.clientId)}bi(){return p(this,null,function*(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let r=ht(e,"clientMetadata");return r.U().next(i=>{let s=this.Ci(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return f.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ei)for(let e of t)this.Ei.removeItem(this.vi(e.clientId))}})}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(t){return!!t&&t.ownerId===this.clientId}gi(t){return this._i?f.resolve(!0):pr(t).get("owner").next(e=>{if(e!==null&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)){if(this.wi(e)&&this.networkEnabled)return!0;if(!this.wi(e)){if(!e.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,qo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Di(t).U().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return p(this,null,function*(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),yield this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new Rr(t,St.oe);return this.pi(e).next(()=>this.Si(e))}),this.Ti.close(),this.Ni()})}Ci(t,e){return t.filter(r=>this.Di(r.updateTimeMs,e)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",t=>Di(t).U().next(e=>this.Ci(e,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(t,e){return ss.ct(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Ca(t,this.serializer.ut.databaseId)}getDocumentOverlayCache(t){return es.ct(this.serializer,t)}getBundleCache(){return this.Kr}runTransaction(t,e,r){_("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(u){return u===16?tg:u===15?ad:u===14?od:u===13?sd:u===12?Zm:u===11?id:void S()}(this.ai),o;return this.Ti.runTransaction(t,i,s,a=>(o=new Rr(a,this.Br?this.Br.next():St.oe),e==="readwrite-primary"?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw J(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new y(g.FAILED_PRECONDITION,td);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(t){return pr(t).get("owner").next(e=>{if(e!==null&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)&&!this.wi(e)&&!(this._i||this.allowTabSynchronization&&e.allowTabSynchronization))throw new y(g.FAILED_PRECONDITION,qo)})}yi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return pr(t).put("owner",e)}static D(){return de.D()}pi(t){let e=pr(t);return e.get("owner").next(r=>this.wi(r)?(_("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):f.resolve())}Di(t,e){let r=Date.now();return!(t<r-e)&&(!(t>r)||(J(`Detected an update time that is in the future: ${t} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ui=()=>{this.Mi();let e=/(?:Version|Mobile)\/1[456]/;Ks()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(t){var e;try{let r=((e=this.Ei)===null||e===void 0?void 0:e.getItem(this.vi(t)))!==null;return _("IndexedDbPersistence",`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return J("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(t){J("Failed to set zombie client id.",t)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function pr(n){return ht(n,"owner")}function Di(n){return ht(n,"clientMetadata")}function Ju(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var Ja=class n{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.ki=r,this.qi=i}static Qi(t,e){let r=b(),i=b();for(let s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(t,e.fromCache,r,i)}};var Ya=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var ls=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=function(){return Ks()?8:ed(Gn())>0?6:4}()}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,r,i){let s={result:null};return this.zi(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(t,e,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Ya;return this.Hi(t,e,o).next(a=>{if(s.result=a,this.$i)return this.Ji(t,e,o,a.size)})}).next(()=>s.result)}Ji(t,e,r,i){return r.documentReadCount<this.Ui?(cn()<=Ft.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",ln(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),f.resolve()):(cn()<=Ft.DEBUG&&_("QueryEngine","Query:",ln(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(cn()<=Ft.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",ln(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Tt(e))):f.resolve())}zi(t,e){if(lh(e))return f.resolve(null);let r=Tt(e);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Hi(e,null,"F"),r=Tt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=b(...s);return this.Gi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(u=>{let c=this.Yi(e,a);return this.Zi(e,c,o,u.readTime)?this.zi(t,Hi(e,null,"F")):this.Xi(t,c,e,u)}))})))}ji(t,e,r,i){return lh(e)||i.isEqual(P.min())?f.resolve(null):this.Gi.getDocuments(t,r).next(s=>{let o=this.Yi(e,s);return this.Zi(e,o,r,i)?f.resolve(null):(cn()<=Ft.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ln(e)),this.Xi(t,o,e,Xh(i,-1)).next(a=>a))})}Yi(t,e){let r=new B(wd(t));return e.forEach((i,s)=>{Jr(t,s)&&(r=r.add(s))}),r}Zi(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(t,e,r){return cn()<=Ft.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",ln(e)),this.Gi.getDocumentsMatchingQuery(t,e,xt.min(),r)}Xi(t,e,r,i){return this.Gi.getDocumentsMatchingQuery(t,r,i).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Xa=class{constructor(t,e,r,i){this.persistence=t,this.es=e,this.serializer=i,this.ts=new K(D),this.ns=new Qt(s=>ze(s),Wr),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(r)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new as(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ts))}};function tf(n,t,e,r){return new Xa(n,t,e,r)}function ef(n,t){return p(this,null,function*(){let e=I(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,e.os(t),e.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=b();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return e.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})})}function Ng(n,t){let e=I(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=e.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),m=f.resolve();return d.forEach(A=>{m=m.next(()=>l.getEntry(u,A)).next(w=>{let v=c.docVersions.get(A);R(v!==null),w.version.compareTo(v)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(e,r,t,s).next(()=>s.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=b();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,i))})}function nf(n){let t=I(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.qr.getLastRemoteSnapshotVersion(e))}function kg(n,t){let e=I(n),r=t.snapshotVersion,i=e.ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.ss.newChangeBuffer({trackRemovals:!0});i=e.ts;let a=[];t.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(e.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>e.qr.addMatchingKeys(s,l.addedDocuments,h)));let m=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?m=m.withResumeToken(lt.EMPTY_BYTE_STRING,P.min()).withLastLimboFreeSnapshotVersion(P.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(h,m),function(w,v,x){return w.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(d,m,l)&&a.push(e.qr.updateTargetData(s,m))});let u=Et(),c=b();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(rf(s,o,t.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(P.min())){let l=e.qr.getLastRemoteSnapshotVersion(s).next(h=>e.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(e.ts=i,s))}function rf(n,t,e){let r=b(),i=b();return e.forEach(s=>r=r.add(s)),t.getEntries(n,r).next(s=>{let o=Et();return e.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(P.min())?(t.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(t.addEntry(u),o=o.insert(a,u)):_("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function Fg(n,t){let e=I(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function xn(n,t){let e=I(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.qr.getTargetData(r,t).next(s=>s?(i=s,f.resolve(i)):e.qr.allocateTargetId(r).next(o=>(i=new Pn(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=e.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.ts=e.ts.insert(r.targetId,r),e.ns.set(t,r.targetId)),r})}function Dn(n,t,e){return p(this,null,function*(){let r=I(n),i=r.ts.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ae(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ts=r.ts.remove(t),r.ns.delete(i.target)})}function hs(n,t,e){let r=I(n),i=P.min(),s=b();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=I(u),d=h.ns.get(l);return d!==void 0?f.resolve(h.ts.get(d)):h.qr.getTargetData(c,l)}(r,o,Tt(t)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,t,e?i:P.min(),e?s:b())).next(a=>(af(r,yd(t),a),{documents:a,ls:s})))}function sf(n,t){let e=I(n),r=I(e.qr),i=e.ts.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,t).next(o=>o?o.target:null))}function of(n,t){let e=I(n),r=e.rs.get(t)||P.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.ss.getAllFromCollectionGroup(i,t,Xh(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(af(e,t,i),i))}function af(n,t,e){let r=n.rs.get(t)||P.min();e.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(t,r)}function Mg(n,t,e,r){return p(this,null,function*(){let i=I(n),s=b(),o=Et();for(let c of e){let l=t.hs(c.metadata.name);c.document&&(s=s.add(l));let h=t.Ps(c);h.setReadTime(t.Is(c.metadata.readTime)),o=o.insert(l,h)}let a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield xn(i,function(l){return Tt(On(M.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>rf(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))})}function Lg(r,i){return p(this,arguments,function*(n,t,e=b()){let s=yield xn(n,Tt(Wu(t.bundledQuery))),o=I(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=X(t.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Kr.saveNamedQuery(a,t);let c=s.withResumeToken(lt.EMPTY_BYTE_STRING,u);return o.ts=o.ts.insert(c.targetId,c),o.qr.updateTargetData(a,c).next(()=>o.qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.qr.addMatchingKeys(a,e,s.targetId)).next(()=>o.Kr.saveNamedQuery(a,t))})})}function Oh(n,t){return`firestore_clients_${n}_${t}`}function qh(n,t,e){let r=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Uo(n,t){return`firestore_targets_${n}_${t}`}var ds=class n{constructor(t,e,r,i){this.user=t,this.batchId=e,this.state=r,this.error=i}static Ts(t,e,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new y(i.error.code,i.error.message))),o?new n(t,e,i.state,s):(J("SharedClientState",`Failed to parse mutation state for ID '${e}': ${r}`),null)}Es(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Tr=class n{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Ts(t,e){let r=JSON.parse(e),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new y(r.error.code,r.error.message))),s?new n(t,r.state,i):(J("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Es(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},fs=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ts(t,e){let r=JSON.parse(e),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=$u();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=nd(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(t,s):(J("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Za=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Ts(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(J("SharedClientState",`Failed to parse online state: ${t}`),null)}},qr=class{constructor(){this.activeTargetIds=$u()}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Er=class{constructor(t,e,r,i,s){this.window=t,this.si=e,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new K(D),this.started=!1,this.ps=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Oh(this.persistenceKey,this.Rs),this.ws=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new qr),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(t){return!(!t||!t.localStorage)}start(){return p(this,null,function*(){let t=yield this.syncEngine.Li();for(let r of t){if(r===this.Rs)continue;let i=this.getItem(Oh(this.persistenceKey,r));if(i){let s=fs.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();let e=this.storage.getItem(this.Cs);if(e){let r=this.Ms(e);r&&this.xs(r)}for(let r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.ws,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(t){let e=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ns(t,"pending")}updateMutationState(t,e,r){this.Ns(t,e,r),this.Ls(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let r=this.storage.getItem(Uo(this.persistenceKey,t));if(r){let i=Tr.Ts(t,r);i&&(e=i.state)}}return this.Bs.ds(t),this.Fs(),e}removeLocalQueryTarget(t){this.Bs.As(t),this.Fs()}isLocalQueryTarget(t){return this.Bs.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Uo(this.persistenceKey,t))}updateQueryState(t,e,r){this.ks(t,e,r)}handleUserChange(t,e,r){e.forEach(i=>{this.Ls(i)}),this.currentUser=t,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.qs(t)}notifyBundleLoaded(t){this.Qs(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return _("SharedClientState","READ",t,e),e}setItem(t,e){_("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){_("SharedClientState","REMOVE",t),this.storage.removeItem(t)}fs(t){let e=t;if(e.storageArea===this.storage){if(_("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ys)return void J("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(()=>p(this,null,function*(){if(this.started){if(e.key!==null){if(this.Ss.test(e.key)){if(e.newValue==null){let r=this.Ks(e.key);return this.$s(r,null)}{let r=this.Us(e.key,e.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(e.key)){if(e.newValue!==null){let r=this.Ws(e.key,e.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let r=this.zs(e.key,e.newValue);if(r)return this.js(r)}}else if(e.key===this.Cs){if(e.newValue!==null){let r=this.Ms(e.newValue);if(r)return this.xs(r)}}else if(e.key===this.ws){let r=function(s){let o=St.oe;if(s!=null)try{let a=JSON.parse(s);R(typeof a=="number"),o=a}catch(a){J("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(e.newValue);r!==St.oe&&this.sequenceNumberHandler(r)}else if(e.key===this.vs){let r=this.Hs(e.newValue);yield Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(e)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(t,e,r){let i=new ds(this.currentUser,t,e,r),s=qh(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Es())}Ls(t){let e=qh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}qs(t){let e={clientId:this.Rs,onlineState:t};this.storage.setItem(this.Cs,JSON.stringify(e))}ks(t,e,r){let i=Uo(this.persistenceKey,t),s=new Tr(t,e,r);this.setItem(i,s.Es())}Qs(t){let e=JSON.stringify(Array.from(t));this.setItem(this.vs,e)}Ks(t){let e=this.Ss.exec(t);return e?e[1]:null}Us(t,e){let r=this.Ks(t);return fs.Ts(r,e)}Ws(t,e){let r=this.bs.exec(t),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return ds.Ts(new nt(s),i,e)}zs(t,e){let r=this.Ds.exec(t),i=Number(r[1]);return Tr.Ts(i,e)}Ms(t){return Za.Ts(t)}Hs(t){return JSON.parse(t)}Gs(t){return p(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Ys(t.batchId,t.state,t.error);_("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}js(t){return this.syncEngine.Zs(t.targetId,t.state,t.error)}$s(t,e){let r=e?this.gs.insert(t,e):this.gs.remove(t),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(t){this.gs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Os(t){let e=$u();return t.forEach((r,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},ms=class{constructor(){this.eo=new qr,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,r){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new qr,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var tu=class{ro(t){}shutdown(){}};var gs=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ao)t(0)}_o(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ao)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var bi=null;function Bo(){return bi===null?bi=function(){return 268435456+Math.round(2147483648*Math.random())}():bi++,"0x"+bi.toString(16)}var Og={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var eu=class{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}Eo(t){this.Ao=t}onMessage(t){this.Ro=t}close(){this.lo()}send(t){this.co(t)}Vo(){this.Po()}mo(){this.To()}fo(t){this.Ao(t)}po(t){this.Ro(t)}};var yt="WebChannelConnection",nu=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+e.host,this.wo=`projects/${i}/databases/${s}`,this.So=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(e,r,i,s,o){let a=Bo(),u=this.Co(e,r.toUriEncodedString());_("RestConnection",`Sending RPC '${e}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(c,s,o),this.Fo(e,u,c,i).then(l=>(_("RestConnection",`Received RPC '${e}' ${a}: `,l),l),l=>{throw Kt("RestConnection",`RPC '${e}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Mo(e,r,i,s,o,a){return this.Do(e,r,i,s,o)}vo(e,r,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ln}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>e[o]=s),i&&i.headers.forEach((s,o)=>e[o]=s)}Co(e,r){let i=Og[e];return`${this.yo}/v1/${r}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Fo(t,e,r,i){let s=Bo();return new Promise((o,a)=>{let u=new Wl;u.setWithCredentials(!0),u.listenOnce(jl.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Pi.NO_ERROR:let l=u.getResponseJson();_(yt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case Pi.TIMEOUT:_(yt,`RPC '${t}' ${s} timed out`),a(new y(g.DEADLINE_EXCEEDED,"Request time out"));break;case Pi.HTTP_ERROR:let h=u.getStatus();if(_(yt,`RPC '${t}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let m=d?.error;if(m&&m.status&&m.message){let A=function(v){let x=v.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(x)>=0?x:g.UNKNOWN}(m.status);a(new y(A,m.message))}else a(new y(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{_(yt,`RPC '${t}' ${s} completed.`)}});let c=JSON.stringify(i);_(yt,`RPC '${t}' ${s} sending request:`,i),u.send(e,"POST",c,r,15)})}xo(t,e,r){let i=Bo(),s=[this.yo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Gl(),a=Kl(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new Ql({})),this.vo(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;let l=s.join("");_(yt,`Creating RPC '${t}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,m=!1,A=new eu({co:v=>{m?_(yt,`Not sending because RPC '${t}' stream ${i} is closed:`,v):(d||(_(yt,`Opening RPC '${t}' stream ${i} transport.`),h.open(),d=!0),_(yt,`RPC '${t}' stream ${i} sending:`,v),h.send(v))},lo:()=>h.close()}),w=(v,x,N)=>{v.listen(x,C=>{try{N(C)}catch(z){setTimeout(()=>{throw z},0)}})};return w(h,dr.EventType.OPEN,()=>{m||(_(yt,`RPC '${t}' stream ${i} transport opened.`),A.Vo())}),w(h,dr.EventType.CLOSE,()=>{m||(m=!0,_(yt,`RPC '${t}' stream ${i} transport closed`),A.fo())}),w(h,dr.EventType.ERROR,v=>{m||(m=!0,Kt(yt,`RPC '${t}' stream ${i} transport errored:`,v),A.fo(new y(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,dr.EventType.MESSAGE,v=>{var x;if(!m){let N=v.data[0];R(!!N);let C=N,z=C.error||((x=C[0])===null||x===void 0?void 0:x.error);if(z){_(yt,`RPC '${t}' stream ${i} received error:`,z);let j=z.status,O=function(Of){let _c=tt[Of];if(_c!==void 0)return Nd(_c)}(j),at=z.message;O===void 0&&(O=g.INTERNAL,at="Unknown error status: "+j+" with message "+z.message),m=!0,A.fo(new y(O,at)),h.close()}else _(yt,`RPC '${t}' stream ${i} received:`,N),A.po(N)}}),w(a,$l.STAT_EVENT,v=>{v.stat===Lo.PROXY?_(yt,`RPC '${t}' stream ${i} detected buffering proxy`):v.stat===Lo.NOPROXY&&_(yt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{A.mo()},0),A}};function uf(){return typeof window<"u"?window:null}function Mi(){return typeof document<"u"?document:null}function Yr(n){return new wa(n,!0)}var Ur=class{constructor(t,e,r=1e3,i=1.5,s=6e4){this.si=t,this.timerId=e,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(t){this.cancel();let e=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,e-r);i>0&&_("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),t())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var ps=class{constructor(t,e,r,i,s,o,a,u){this.si=t,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new Ur(t,e)}Yo(){return this.state===1||this.state===5||this.Zo()}Zo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Xo()}stop(){return p(this,null,function*(){this.Yo()&&(yield this.close(0))})}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&this.jo===null&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(t){this.i_(),this.stream.send(t)}n_(){return p(this,null,function*(){if(this.Zo())return this.close(0)})}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(t,e){return p(this,null,function*(){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,t!==4?this.Jo.reset():e&&e.code===g.RESOURCE_EXHAUSTED?(J(e.toString()),J("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):e&&e.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.o_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.Eo(e)})}o_(){}auth(){this.state=1;let t=this.__(this.zo),e=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===e&&this.a_(r,i)},r=>{t(()=>{let i=new y(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(t,e){let r=this.__(this.zo);this.stream=this.c_(t,e),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){this.state=5,this.Jo.Ko(()=>p(this,null,function*(){this.state=0,this.start()}))}u_(t){return _("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}__(t){return e=>{this.si.enqueueAndForget(()=>this.zo===t?e():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ru=class extends ps{constructor(t,e,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}c_(t,e){return this.connection.xo("Listen",t,e)}onMessage(t){this.Jo.reset();let e=Tg(this.serializer,t),r=function(s){if(!("targetChange"in s))return P.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?P.min():o.readTime?X(o.readTime):P.min()}(t);return this.listener.l_(e,r)}h_(t){let e={};e.database=Ta(this.serializer),e.addTarget=function(s,o){let a,u=o.target;if(a=Qi(u)?{documents:Bd(s,u)}:{query:zd(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Fd(s,o.resumeToken);let c=va(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(P.min())>0){a.readTime=Rn(s,o.snapshotVersion.toTimestamp());let c=va(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,t);let r=Ag(this.serializer,t);r&&(e.labels=r),this.r_(e)}P_(t){let e={};e.database=Ta(this.serializer),e.removeTarget=t,this.r_(e)}},iu=class extends ps{constructor(t,e,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(t,e){return this.connection.xo("Write",t,e)}onMessage(t){if(R(!!t.streamToken),this.lastStreamToken=t.streamToken,this.I_){this.Jo.reset();let e=Eg(t.writeResults,t.commitTime),r=X(t.commitTime);return this.listener.d_(r,e)}return R(!t.writeResults||t.writeResults.length===0),this.I_=!0,this.listener.A_()}R_(){let t={};t.database=Ta(this.serializer),this.r_(t)}E_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Mr(this.serializer,r))};this.r_(e)}};var su=class extends class{}{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}Do(t,e,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(t,Ia(e,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(g.UNKNOWN,s.toString())})}Mo(t,e,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(t,Ia(e,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(g.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}};var ou=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(t){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,t==="Online"&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(J(e),this.y_=!1):_("OnlineStateTracker",e)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var au=class{constructor(t,e,r,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(o=>{r.enqueueAndForget(()=>p(this,null,function*(){Se(this)&&(_("RemoteStore","Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let c=I(u);c.M_.add(4),yield qn(c),c.N_.set("Unknown"),c.M_.delete(4),yield Xr(c)})}(this))}))}),this.N_=new ou(r,i)}};function Xr(n){return p(this,null,function*(){if(Se(n))for(let t of n.x_)yield t(!0)})}function qn(n){return p(this,null,function*(){for(let t of n.x_)yield t(!1)})}function Fs(n,t){let e=I(n);e.F_.has(t.targetId)||(e.F_.set(t.targetId,t),Zu(e)?Xu(e):Bn(e).Zo()&&Yu(e,t))}function bn(n,t){let e=I(n),r=Bn(e);e.F_.delete(t),r.Zo()&&cf(e,t),e.F_.size===0&&(r.Zo()?r.t_():Se(e)&&e.N_.set("Unknown"))}function Yu(n,t){if(n.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(P.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Bn(n).h_(t)}function cf(n,t){n.L_.xe(t),Bn(n).P_(t)}function Xu(n){n.L_=new ya({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>n.F_.get(t)||null,tt:()=>n.datastore.serializer.databaseId}),Bn(n).start(),n.N_.w_()}function Zu(n){return Se(n)&&!Bn(n).Yo()&&n.F_.size>0}function Se(n){return I(n).M_.size===0}function lf(n){n.L_=void 0}function qg(n){return p(this,null,function*(){n.N_.set("Online")})}function Ug(n){return p(this,null,function*(){n.F_.forEach((t,e)=>{Yu(n,t)})})}function Bg(n,t){return p(this,null,function*(){lf(n),Zu(n)?(n.N_.D_(t),Xu(n)):n.N_.set("Unknown")})}function zg(n,t,e){return p(this,null,function*(){if(n.N_.set("Online"),t instanceof Yi&&t.state===2&&t.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(n,t)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield _s(n,r)}else if(t instanceof _n?n.L_.Ke(t):t instanceof Ji?n.L_.He(t):n.L_.We(t),!e.isEqual(P.min()))try{let r=yield nf(n.localStore);e.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.F_.get(c);l&&s.F_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.F_.get(u);if(!l)return;s.F_.set(u,l.withResumeToken(lt.EMPTY_BYTE_STRING,l.snapshotVersion)),cf(s,u);let h=new Pn(l.target,u,c,l.sequenceNumber);Yu(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(r){_("RemoteStore","Failed to raise snapshot:",r),yield _s(n,r)}})}function _s(n,t,e){return p(this,null,function*(){if(!Ae(t))throw t;n.M_.add(1),yield qn(n),n.N_.set("Offline"),e||(e=()=>nf(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){_("RemoteStore","Retrying IndexedDB access"),yield e(),n.M_.delete(1),yield Xr(n)}))})}function hf(n,t){return t().catch(e=>_s(n,e,t))}function Un(n){return p(this,null,function*(){let t=I(n),e=we(t),r=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;Gg(t);)try{let i=yield Fg(t.localStore,r);if(i===null){t.v_.length===0&&e.t_();break}r=i.batchId,Kg(t,i)}catch(i){yield _s(t,i)}df(t)&&ff(t)})}function Gg(n){return Se(n)&&n.v_.length<10}function Kg(n,t){n.v_.push(t);let e=we(n);e.Zo()&&e.T_&&e.E_(t.mutations)}function df(n){return Se(n)&&!we(n).Yo()&&n.v_.length>0}function ff(n){we(n).start()}function jg(n){return p(this,null,function*(){we(n).R_()})}function $g(n){return p(this,null,function*(){let t=we(n);for(let e of n.v_)t.E_(e.mutations)})}function Qg(n,t,e){return p(this,null,function*(){let r=n.v_.shift(),i=ga.from(r,t,e);yield hf(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Un(n)})}function Wg(n,t){return p(this,null,function*(){t&&we(n).T_&&(yield function(r,i){return p(this,null,function*(){if(function(o){return Cd(o)&&o!==g.ABORTED}(i.code)){let s=r.v_.shift();we(r).e_(),yield hf(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Un(r)}})}(n,t)),df(n)&&ff(n)})}function Uh(n,t){return p(this,null,function*(){let e=I(n);e.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");let r=Se(e);e.M_.add(3),yield qn(e),r&&e.N_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.M_.delete(3),yield Xr(e)})}function uu(n,t){return p(this,null,function*(){let e=I(n);t?(e.M_.delete(2),yield Xr(e)):t||(e.M_.add(2),yield qn(e),e.N_.set("Unknown"))})}function Bn(n){return n.B_||(n.B_=function(e,r,i){let s=I(e);return s.m_(),new ru(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:qg.bind(null,n),Io:Ug.bind(null,n),Eo:Bg.bind(null,n),l_:zg.bind(null,n)}),n.x_.push(t=>p(this,null,function*(){t?(n.B_.e_(),Zu(n)?Xu(n):n.N_.set("Unknown")):(yield n.B_.stop(),lf(n))}))),n.B_}function we(n){return n.k_||(n.k_=function(e,r,i){let s=I(e);return s.m_(),new iu(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:jg.bind(null,n),Eo:Wg.bind(null,n),A_:$g.bind(null,n),d_:Qg.bind(null,n)}),n.x_.push(t=>p(this,null,function*(){t?(n.k_.e_(),yield Un(n)):(yield n.k_.stop(),n.v_.length>0&&(_("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var cu=class n{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){let o=Date.now()+r,a=new n(t,e,o,i,s);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function zn(n,t){if(J("AsyncQueue",`${t}: ${n}`),Ae(n))return new y(g.UNAVAILABLE,`${t}: ${n}`);throw n}var ys=class n{constructor(t){this.comparator=t?(e,r)=>t(e,r)||E.comparator(e.key,r.key):(e,r)=>E.comparator(e.key,r.key),this.keyedMap=_r(),this.sortedSet=new K(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var ws=class{constructor(){this.q_=new K(E.comparator)}track(t){let e=t.doc.key,r=this.q_.get(e);r?t.type!==0&&r.type===3?this.q_=this.q_.insert(e,t):t.type===3&&r.type!==1?this.q_=this.q_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.q_=this.q_.remove(e):t.type===1&&r.type===2?this.q_=this.q_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):S():this.q_=this.q_.insert(e,t)}Q_(){let t=[];return this.q_.inorderTraversal((e,r)=>{t.push(r)}),t}},Cn=class n{constructor(t,e,r,i,s,o,a,u,c){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,r,i,s){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,ys.emptySet(e),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Hr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}};var lu=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(t=>t.G_())}},hu=class{constructor(){this.queries=new Qt(t=>_d(t),Hr),this.onlineState="Unknown",this.z_=new Set}};function tc(n,t){return p(this,null,function*(){let e=I(n),r=3,i=t.query,s=e.queries.get(i);s?!s.W_()&&t.G_()&&(r=2):(s=new lu,r=t.G_()?0:1);try{switch(r){case 0:s.K_=yield e.onListen(i,!0);break;case 1:s.K_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(o){let a=zn(o,`Initialization of query '${ln(t.query)}' failed`);return void t.onError(a)}e.queries.set(i,s),s.U_.push(t),t.j_(e.onlineState),s.K_&&t.H_(s.K_)&&nc(e)})}function ec(n,t){return p(this,null,function*(){let e=I(n),r=t.query,i=3,s=e.queries.get(r);if(s){let o=s.U_.indexOf(t);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=t.G_()?0:1:!s.W_()&&t.G_()&&(i=2))}switch(i){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function Hg(n,t){let e=I(n),r=!1;for(let i of t){let s=i.query,o=e.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&nc(e)}function Jg(n,t,e){let r=I(n),i=r.queries.get(t);if(i)for(let s of i.U_)s.onError(e);r.queries.delete(t)}function nc(n){n.z_.forEach(t=>{t.next()})}var du,Bh;(Bh=du||(du={})).J_="default",Bh.Cache="cache";var Br=class{constructor(t,e,r){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new Cn(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache||!this.G_())return!0;let r=e!=="Offline";return(!this.options.ra||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ea(t){if(t.docChanges.length>0)return!0;let e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}na(t){t=Cn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==du.Cache}};var fu=class{constructor(t,e){this.ia=t,this.byteLength=e}sa(){return"metadata"in this.ia}};var vs=class{constructor(t){this.serializer=t}hs(t){return zt(this.serializer,t)}Ps(t){return t.metadata.exists?Ud(this.serializer,t.document,!1):it.newNoDocument(this.hs(t.metadata.name),this.Is(t.metadata.readTime))}Is(t){return X(t)}},mu=class{constructor(t,e,r){this.oa=t,this.localStore=e,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=mf(t)}_a(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ia.namedQuery)this.queries.push(t.ia.namedQuery);else if(t.ia.documentMetadata){this.documents.push({metadata:t.ia.documentMetadata}),t.ia.documentMetadata.exists||++e;let r=M.fromString(t.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.ia.document&&(this.documents[this.documents.length-1].document=t.ia.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}aa(t){let e=new Map,r=new vs(this.serializer);for(let i of t)if(i.metadata.queries){let s=r.hs(i.metadata.name);for(let o of i.metadata.queries){let a=(e.get(o)||b()).add(s);e.set(o,a)}}return e}complete(){return p(this,null,function*(){let t=yield Mg(this.localStore,new vs(this.serializer),this.documents,this.oa.id),e=this.aa(this.documents);for(let r of this.queries)yield Lg(this.localStore,r,e.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:t}})}};function mf(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Is=class{constructor(t){this.key=t}},Ts=class{constructor(t){this.key=t}},Es=class{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=b(),this.mutatedKeys=b(),this.Ia=wd(t),this.Ta=new ys(this.Ia)}get Ea(){return this.la}da(t,e){let r=e?e.Aa:new ws,i=e?e.Ta:this.Ta,s=e?e.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((l,h)=>{let d=i.get(l),m=Jr(this.query,h)?h:null,A=!!d&&this.mutatedKeys.has(d.key),w=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),v=!1;d&&m?d.data.isEqual(m.data)?A!==w&&(r.track({type:3,doc:m}),v=!0):this.Ra(d,m)||(r.track({type:2,doc:m}),v=!0,(u&&this.Ia(m,u)>0||c&&this.Ia(m,c)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),v=!0):d&&!m&&(r.track({type:1,doc:d}),v=!0,(u||c)&&(a=!0)),v&&(m?(o=o.add(m),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){let s=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;let o=t.Aa.Q_();o.sort((l,h)=>function(m,A){let w=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return w(m)-w(A)}(l.type,h.type)||this.Ia(l.doc,h.doc)),this.Va(r),i=i!=null&&i;let a=e&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,c=u!==this.ha;return this.ha=u,o.length!==0||c?{snapshot:new Cn(this.query,t.Ta,s,o,t.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new ws,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach(e=>this.la=this.la.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=t.current)}ma(){if(!this.current)return[];let t=this.Pa;this.Pa=b(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let e=[];return t.forEach(r=>{this.Pa.has(r)||e.push(new Ts(r))}),this.Pa.forEach(r=>{t.has(r)||e.push(new Is(r))}),e}pa(t){this.la=t.ls,this.Pa=b();let e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return Cn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},gu=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},pu=class{constructor(t){this.key=t,this.wa=!1}},_u=class{constructor(t,e,r,i,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new Qt(a=>_d(a),Hr),this.Da=new Map,this.Ca=new Set,this.va=new K(E.comparator),this.Fa=new Map,this.Ma=new Or,this.xa={},this.Oa=new Map,this.Na=Vn.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function Yg(n,t,e=!0){return p(this,null,function*(){let r=Ms(n),i,s=r.ba.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield gf(r,t,e,!0),i})}function Xg(n,t){return p(this,null,function*(){let e=Ms(n);yield gf(e,t,!0,!1)})}function gf(n,t,e,r){return p(this,null,function*(){let i=yield xn(n.localStore,Tt(t)),s=i.targetId,o=e?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield rc(n,t,s,o==="current",i.resumeToken)),n.isPrimaryClient&&e&&Fs(n.remoteStore,i),a})}function rc(n,t,e,r,i){return p(this,null,function*(){n.Ba=(h,d,m)=>function(w,v,x,N){return p(this,null,function*(){let C=v.view.da(x);C.Zi&&(C=yield hs(w.localStore,v.query,!1).then(({documents:at})=>v.view.da(at,C)));let z=N&&N.targetChanges.get(v.targetId),j=N&&N.targetMismatches.get(v.targetId)!=null,O=v.view.applyChanges(C,w.isPrimaryClient,z,j);return yu(w,v.targetId,O.fa),O.snapshot})}(n,h,d,m);let s=yield hs(n.localStore,t,!0),o=new Es(t,s.ls),a=o.da(s.documents),u=kr.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);yu(n,e,c.fa);let l=new gu(t,e,o);return n.ba.set(t,l),n.Da.has(e)?n.Da.get(e).push(t):n.Da.set(e,[t]),c.snapshot})}function Zg(n,t,e){return p(this,null,function*(){let r=I(n),i=r.ba.get(t),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Hr(o,t))),void r.ba.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Dn(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),e&&bn(r.remoteStore,i.targetId),Nn(r,i.targetId)}).catch(Ee))):(Nn(r,i.targetId),yield Dn(r.localStore,i.targetId,!0))})}function tp(n,t){return p(this,null,function*(){let e=I(n),r=e.ba.get(t),i=e.Da.get(r.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),bn(e.remoteStore,r.targetId))})}function ep(n,t,e){return p(this,null,function*(){let r=ac(n);try{let i=yield function(o,a){let u=I(o),c=Y.now(),l=a.reduce((m,A)=>m.add(A.key),b()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",m=>{let A=Et(),w=b();return u.ss.getEntries(m,l).next(v=>{A=v,A.forEach((x,N)=>{N.isValidDocument()||(w=w.add(x))})}).next(()=>u.localDocuments.getOverlayedDocuments(m,A)).next(v=>{h=v;let x=[];for(let N of a){let C=gg(N,h.get(N.key).overlayedDocument);C!=null&&x.push(new Nt(N.key,C,ld(C.value.mapValue),H.exists(!0)))}return u.mutationQueue.addMutationBatch(m,c,x,a)}).next(v=>{d=v;let x=v.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(m,v.batchId,x)})}).then(()=>({batchId:d.batchId,changes:Id(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.xa[o.currentUser.toKey()];c||(c=new K(D)),c=c.insert(a,u),o.xa[o.currentUser.toKey()]=c}(r,i.batchId,e),yield re(r,i.changes),yield Un(r.remoteStore)}catch(i){let s=zn(i,"Failed to persist write");e.reject(s)}})}function pf(n,t){return p(this,null,function*(){let e=I(n);try{let r=yield kg(e.localStore,t);t.targetChanges.forEach((i,s)=>{let o=e.Fa.get(s);o&&(R(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?R(o.wa):i.removedDocuments.size>0&&(R(o.wa),o.wa=!1))}),yield re(e,r,t)}catch(r){yield Ee(r)}})}function zh(n,t,e){let r=I(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(t);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=I(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.U_)d.j_(a)&&(c=!0)}),c&&nc(u)}(r.eventManager,t),i.length&&r.Sa.l_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function np(n,t,e){return p(this,null,function*(){let r=I(n);r.sharedClientState.updateQueryState(t,"rejected",e);let i=r.Fa.get(t),s=i&&i.key;if(s){let o=new K(E.comparator);o=o.insert(s,it.newNoDocument(s,P.min()));let a=b().add(s),u=new Nr(P.min(),new Map,new K(D),o,a);yield pf(r,u),r.va=r.va.remove(s),r.Fa.delete(t),oc(r)}else yield Dn(r.localStore,t,!1).then(()=>Nn(r,t,e)).catch(Ee)})}function rp(n,t){return p(this,null,function*(){let e=I(n),r=t.batch.batchId;try{let i=yield Ng(e.localStore,t);sc(e,r,null),ic(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield re(e,i)}catch(i){yield Ee(i)}})}function ip(n,t,e){return p(this,null,function*(){let r=I(n);try{let i=yield function(o,a){let u=I(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(R(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,t);sc(r,t,e),ic(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield re(r,i)}catch(i){yield Ee(i)}})}function sp(n,t){return p(this,null,function*(){let e=I(n);Se(e.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=I(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(e.localStore);if(r===-1)return void t.resolve();let i=e.Oa.get(r)||[];i.push(t),e.Oa.set(r,i)}catch(r){let i=zn(r,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function ic(n,t){(n.Oa.get(t)||[]).forEach(e=>{e.resolve()}),n.Oa.delete(t)}function sc(n,t,e){let r=I(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.xa[r.currentUser.toKey()]=i}}function Nn(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Da.get(t))n.ba.delete(r),e&&n.Sa.ka(r,e);n.Da.delete(t),n.isPrimaryClient&&n.Ma.Rr(t).forEach(r=>{n.Ma.containsKey(r)||_f(n,r)})}function _f(n,t){n.Ca.delete(t.path.canonicalString());let e=n.va.get(t);e!==null&&(bn(n.remoteStore,e),n.va=n.va.remove(t),n.Fa.delete(e),oc(n))}function yu(n,t,e){for(let r of e)r instanceof Is?(n.Ma.addReference(r.key,t),op(n,r)):r instanceof Ts?(_("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,t),n.Ma.containsKey(r.key)||_f(n,r.key)):S()}function op(n,t){let e=t.key,r=e.path.canonicalString();n.va.get(e)||n.Ca.has(r)||(_("SyncEngine","New document in limbo: "+e),n.Ca.add(r),oc(n))}function oc(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let t=n.Ca.values().next().value;n.Ca.delete(t);let e=new E(M.fromString(t)),r=n.Na.next();n.Fa.set(r,new pu(e)),n.va=n.va.insert(e,r),Fs(n.remoteStore,new Pn(Tt(On(e.path)),r,"TargetPurposeLimboResolution",St.oe))}}function re(n,t,e){return p(this,null,function*(){let r=I(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,t,e).then(c=>{if((c||e)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=Ja.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Sa.l_(i),yield function(u,c){return p(this,null,function*(){let l=I(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>f.forEach(c,d=>f.forEach(d.ki,m=>l.persistence.referenceDelegate.addReference(h,d.targetId,m)).next(()=>f.forEach(d.qi,m=>l.persistence.referenceDelegate.removeReference(h,d.targetId,m)))))}catch(h){if(!Ae(h))throw h;_("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let m=l.ts.get(d),A=m.snapshotVersion,w=m.withLastLimboFreeSnapshotVersion(A);l.ts=l.ts.insert(d,w)}}})}(r.localStore,s))})}function ap(n,t){return p(this,null,function*(){let e=I(n);if(!e.currentUser.isEqual(t)){_("SyncEngine","User change. New user:",t.toKey());let r=yield ef(e.localStore,t);e.currentUser=t,function(s,o){s.Oa.forEach(a=>{a.forEach(u=>{u.reject(new y(g.CANCELLED,o))})}),s.Oa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield re(e,r._s)}})}function up(n,t){let e=I(n),r=e.Fa.get(t);if(r&&r.wa)return b().add(r.key);{let i=b(),s=e.Da.get(t);if(!s)return i;for(let o of s){let a=e.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function cp(n,t){return p(this,null,function*(){let e=I(n),r=yield hs(e.localStore,t.query,!0),i=t.view.pa(r);return e.isPrimaryClient&&yu(e,t.targetId,i.fa),i})}function lp(n,t){return p(this,null,function*(){let e=I(n);return of(e.localStore,t).then(r=>re(e,r))})}function hp(n,t,e,r){return p(this,null,function*(){let i=I(n),s=yield function(a,u){let c=I(a),l=I(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):f.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield Un(i.remoteStore):e==="acknowledged"||e==="rejected"?(sc(i,t,r||null),ic(i,t),function(a,u){I(I(a).mutationQueue).Fn(u)}(i.localStore,t)):S(),yield re(i,s)):_("SyncEngine","Cannot apply mutation batch with id: "+t)})}function dp(n,t){return p(this,null,function*(){let e=I(n);if(Ms(e),ac(e),t===!0&&e.La!==!0){let r=e.sharedClientState.getAllActiveQueryTargets(),i=yield Gh(e,r.toArray());e.La=!0,yield uu(e.remoteStore,!0);for(let s of i)Fs(e.remoteStore,s)}else if(t===!1&&e.La!==!1){let r=[],i=Promise.resolve();e.Da.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Nn(e,o),Dn(e.localStore,o,!0))),bn(e.remoteStore,o)}),yield i,yield Gh(e,r),function(o){let a=I(o);a.Fa.forEach((u,c)=>{bn(a.remoteStore,c)}),a.Ma.Vr(),a.Fa=new Map,a.va=new K(E.comparator)}(e),e.La=!1,yield uu(e.remoteStore,!1)}})}function Gh(n,t,e){return p(this,null,function*(){let r=I(n),i=[],s=[];for(let o of t){let a,u=r.Da.get(o);if(u&&u.length!==0){a=yield xn(r.localStore,Tt(u[0]));for(let c of u){let l=r.ba.get(c),h=yield cp(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield sf(r.localStore,o);a=yield xn(r.localStore,c),yield rc(r,yf(c),o,!1,a.resumeToken)}i.push(a)}return r.Sa.l_(s),i})}function yf(n){return pd(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function fp(n){return function(e){return I(I(e).persistence).Li()}(I(n).localStore)}function mp(n,t,e,r){return p(this,null,function*(){let i=I(n);if(i.La)return void _("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let o=yield of(i.localStore,yd(s[0])),a=Nr.createSynthesizedRemoteEventForCurrentChange(t,e==="current",lt.EMPTY_BYTE_STRING);yield re(i,o,a);break}case"rejected":yield Dn(i.localStore,t,!0),Nn(i,t,r);break;default:S()}})}function gp(n,t,e){return p(this,null,function*(){let r=Ms(n);if(r.La){for(let i of t){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){_("SyncEngine","Adding an already active target "+i);continue}let s=yield sf(r.localStore,i),o=yield xn(r.localStore,s);yield rc(r,yf(s),o.targetId,!1,o.resumeToken),Fs(r.remoteStore,o)}for(let i of e)r.Da.has(i)&&(yield Dn(r.localStore,i,!1).then(()=>{bn(r.remoteStore,i),Nn(r,i)}).catch(Ee))}})}function Ms(n){let t=I(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=pf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=up.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=np.bind(null,t),t.Sa.l_=Hg.bind(null,t.eventManager),t.Sa.ka=Jg.bind(null,t.eventManager),t}function ac(n){let t=I(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=rp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ip.bind(null,t),t}function pp(n,t,e){let r=I(n);(function(s,o,a){return p(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(m,A){let w=I(m),v=X(A.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",x=>w.Kr.getBundleMetadata(x,A.id)).then(x=>!!x&&x.createTime.compareTo(v)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(m){return{taskState:"Success",documentsLoaded:m.totalDocuments,bytesLoaded:m.totalBytes,totalDocuments:m.totalDocuments,totalBytes:m.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(mf(u));let c=new mu(u,s.localStore,o.serializer),l=yield o.qa();for(;l;){let d=yield c._a(l);d&&a._updateProgress(d),l=yield o.qa()}let h=yield c.complete();return yield re(s,h.ca,void 0),yield function(m,A){let w=I(m);return w.persistence.runTransaction("Save bundle","readwrite",v=>w.Kr.saveBundleMetadata(v,A))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h.ua)}catch(u){return Kt("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,t,e).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var zr=class{constructor(){this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=Yr(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return tf(this.persistence,new ls,t.initialUser,this.serializer)}createPersistence(t){return new us(cs.jr,this.serializer)}createSharedClientState(t){return new ms}terminate(){return p(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var As=class n extends zr{constructor(t,e,r){super(),this.Qa=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){yield Gs(n.prototype,this,"initialize").call(this,t),yield this.Qa.initialize(this,t),yield ac(this.Qa.syncEngine),yield Un(this.Qa.remoteStore),yield this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return tf(this.persistence,new ls,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let r=this.persistence.referenceDelegate.garbageCollector;return new Fa(r,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let r=new Zo(e,this.persistence);return new Xo(t.asyncQueue,r)}createPersistence(t){let e=Ju(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Vt.withCacheSize(this.cacheSizeBytes):Vt.DEFAULT;return new Ha(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,uf(),Mi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new ms}},wu=class n extends As{constructor(t,e){super(t,e,!1),this.Qa=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return p(this,null,function*(){yield Gs(n.prototype,this,"initialize").call(this,t);let e=this.Qa.syncEngine;this.sharedClientState instanceof Er&&(this.sharedClientState.syncEngine={Ys:hp.bind(null,e),Zs:mp.bind(null,e),Xs:gp.bind(null,e),Li:fp.bind(null,e),Js:lp.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.mi(r=>p(this,null,function*(){yield dp(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=uf();if(!Er.D(e))throw new y(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Ju(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Er(e,t.asyncQueue,r,t.clientId,t.initialUser)}},Gr=class{initialize(t,e){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>zh(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=ap.bind(null,this.syncEngine),yield uu(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new hu}()}createDatastore(t){let e=Yr(t.databaseInfo.databaseId),r=function(s){return new nu(s)}(t.databaseInfo);return function(s,o,a,u){return new su(s,o,a,u)}(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return function(r,i,s,o,a){return new au(r,i,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>zh(this.syncEngine,e,0),function(){return gs.D()?new gs:new tu}())}createSyncEngine(t,e){return function(i,s,o,a,u,c,l){let h=new _u(i,s,o,a,u,c);return l&&(h.La=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return p(this,null,function*(){var t;yield function(r){return p(this,null,function*(){let i=I(r);_("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield qn(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};function Kh(n,t=10240){let e=0;return{read(){return p(this,null,function*(){if(e<n.byteLength){let i={value:n.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var kn=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):J("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var vu=class{constructor(t,e){this.Ua=t,this.serializer=e,this.metadata=new rt,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}qa(){return p(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return p(this,null,function*(){let t=yield this.za();if(t===null)return null;let e=this.Wa.decode(t),r=Number(e);isNaN(r)&&this.ja(`length string (${e}) is not valid number`);let i=yield this.Ha(r);return new fu(JSON.parse(i),t.length+r)})}Ja(){return this.buffer.findIndex(t=>t===123)}za(){return p(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let t=this.Ja();t<0&&this.ja("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Ha(t){return p(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let e=this.Wa.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}ja(t){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${t}`)}Ya(){return p(this,null,function*(){let t=yield this.Ua.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var Iu=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return p(this,null,function*(){let o=I(i),a={documents:s.map(h=>Fr(o.serializer,h))},u=yield o.Mo("BatchGetDocuments",o.serializer.databaseId,M.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=Ig(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());R(!!d),l.push(d)}),l})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new ye(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let i=E.fromPath(r);this.mutations.push(new Dr(i,this.precondition(i)))}),yield function(r,i){return p(this,null,function*(){let s=I(r),o={writes:i.map(a=>Mr(s.serializer,a))};yield s.Do("Commit",s.serializer.databaseId,M.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=P.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new y(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(P.min())?H.exists(!1):H.updateTime(e):H.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(P.min()))throw new y(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return H.updateTime(e)}return H.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Tu=class{constructor(t,e,r,i,s){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new Ur(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Jo.Ko(()=>p(this,null,function*(){let t=new Iu(this.datastore),e=this.tu(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(t){try{let e=this.updateFunction(t);return!Qr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}nu(t){this.Za>0&&this.ru(t)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(t)}ru(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Cd(e)}return!1}};var Eu=class{constructor(t,e,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=nt.UNAUTHENTICATED,this.clientId=qi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>p(this,null,function*(){_("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(_("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=zn(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Li(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(i=>p(this,null,function*(){r.isEqual(i)||(yield ef(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function Au(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield uc(n);_("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>Uh(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Uh(t.remoteStore,i)),n._onlineComponents=t})}function wf(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function uc(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Li(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!wf(e))throw e;Kt("Error using user provided cache. Falling back to memory cache: "+e),yield Li(n,new zr)}}else _("FirestoreClient","Using default OfflineComponentProvider"),yield Li(n,new zr);return n._offlineComponents})}function Ls(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),yield Au(n,n._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),yield Au(n,new Gr))),n._onlineComponents})}function vf(n){return uc(n).then(t=>t.persistence)}function cc(n){return uc(n).then(t=>t.localStore)}function If(n){return Ls(n).then(t=>t.remoteStore)}function lc(n){return Ls(n).then(t=>t.syncEngine)}function _p(n){return Ls(n).then(t=>t.datastore)}function Fn(n){return p(this,null,function*(){let t=yield Ls(n),e=t.eventManager;return e.onListen=Yg.bind(null,t.syncEngine),e.onUnlisten=Zg.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Xg.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=tp.bind(null,t.syncEngine),e})}function yp(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield vf(n),e=yield If(n);return t.setNetworkEnabled(!0),function(i){let s=I(i);return s.M_.delete(0),Xr(s)}(e)}))}function wp(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield vf(n),e=yield If(n);return t.setNetworkEnabled(!1),function(i){return p(this,null,function*(){let s=I(i);s.M_.add(0),yield qn(s),s.N_.set("Offline")})}(e)}))}function vp(n,t){let e=new rt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield function(c,l){let h=I(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=zn(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield cc(n),t,e)})),e.promise}function Tf(n,t,e={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new kn({next:d=>{o.enqueueAndForget(()=>ec(s,h));let m=d.docs.has(a);!m&&d.fromCache?c.reject(new y(g.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&u&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Br(On(a.path),l,{includeMetadataChanges:!0,ra:!0});return tc(s,h)}(yield Fn(n),n.asyncQueue,t,e,r)})),r.promise}function Ip(n,t){let e=new rt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield hs(i,s,!0),u=new Es(s,a.ls),c=u.da(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=zn(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield cc(n),t,e)})),e.promise}function Ef(n,t,e={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new kn({next:d=>{o.enqueueAndForget(()=>ec(s,h)),d.fromCache&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Br(a,l,{includeMetadataChanges:!0,ra:!0});return tc(s,h)}(yield Fn(n),n.asyncQueue,t,e,r)})),r.promise}function Tp(n,t){let e=new kn(t);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){I(i).z_.add(s),s.next()}(yield Fn(n),e)})),()=>{e.$a(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){I(i).z_.delete(s)}(yield Fn(n),e)}))}}function Ep(n,t,e,r){let i=function(o,a){let u;return u=typeof o=="string"?kd().encode(o):o,function(l,h){return new vu(l,h)}(function(l,h){if(l instanceof Uint8Array)return Kh(l,h);if(l instanceof ArrayBuffer)return Kh(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(e,Yr(t));n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){pp(yield lc(n),i,r)}))}function Ap(n,t){return n.asyncQueue.enqueue(()=>p(this,null,function*(){return function(r,i){let s=I(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield cc(n),t)}))}function Af(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var jh=new Map;function hc(n,t,e){if(!e)throw new y(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Sp(n,t,e,r){if(t===!0&&r===!0)throw new y(g.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function $h(n){if(!E.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Qh(n){if(E.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Os(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":S()}function L(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new y(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Os(n);throw new y(g.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function Sf(n,t){if(t<=0)throw new y(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var Ss=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new y(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new y(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Sp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Af((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},$e=class{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ss({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ss(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new zo;switch(r.type){case"firstParty":return new $o(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=jh.get(e);r&&(_("ComponentProvider","Removing Datastore"),jh.delete(e),r.terminate())}(this),Promise.resolve()}};function Rp(n,t,e,r={}){var i;let s=(n=L(n,$e))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Kt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=nt.MOCK_USER;else{a=wc(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new y(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new nt(c)}n._authCredentials=new Go(new Oi(a,u))}}var mt=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},Z=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gt(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},Gt=class n extends mt{constructor(t,e,r){super(t,e,On(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new Z(this.firestore,null,new E(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function Wp(n,t,...e){if(n=st(n),hc("collection","path",t),n instanceof $e){let r=M.fromString(t,...e);return Qh(r),new Gt(n,null,r)}{if(!(n instanceof Z||n instanceof Gt))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(M.fromString(t,...e));return Qh(r),new Gt(n.firestore,null,r)}}function Hp(n,t){if(n=L(n,$e),hc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new mt(n,null,function(r){return new Ct(M.emptyPath(),r)}(t))}function Pp(n,t,...e){if(n=st(n),arguments.length===1&&(t=qi.newId()),hc("doc","path",t),n instanceof $e){let r=M.fromString(t,...e);return $h(r),new Z(n,null,new E(r))}{if(!(n instanceof Z||n instanceof Gt))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(M.fromString(t,...e));return $h(r),new Z(n.firestore,n instanceof Gt?n.converter:null,new E(r))}}function Jp(n,t){return n=st(n),t=st(t),(n instanceof Z||n instanceof Gt)&&(t instanceof Z||t instanceof Gt)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function Vp(n,t){return n=st(n),t=st(t),n instanceof mt&&t instanceof mt&&n.firestore===t.firestore&&Hr(n._query,t._query)&&n.converter===t.converter}var Su=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Ur(this,"async_queue_retry"),this.hu=()=>{let e=Mi();e&&_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Jo.Uo()};let t=Mi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;let e=Mi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise(()=>{});let e=new rt;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.su.push(t),this.Tu()))}Tu(){return p(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(t){if(!Ae(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(t){let e=this.iu.then(()=>(this.uu=!0,t().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw J("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=e,e}enqueueAfterDelay(t,e,r){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);let i=cu.createAndSchedule(this,t,e,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&S()}verifyOperationInProgress(){}du(){return p(this,null,function*(){let t;do t=this.iu,yield t;while(t!==this.iu)})}Au(t){for(let e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then(()=>{this._u.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this._u)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.du()})}Vu(t){this.lu.push(t)}Eu(t){let e=this._u.indexOf(t);this._u.splice(e,1)}};function Ru(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Pu=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new rt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var Yp=-1,$=class extends $e{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=function(){return new Su}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Rf(this),this._firestoreClient.terminate()}};function Xp(n,t){let e=typeof n=="object"?n:Pc(),r=typeof n=="string"?n:t||"(default)",i=Sc(e,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=yc("firestore");s&&Rp(i,...s)}return i}function gt(n){return n._firestoreClient||Rf(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Rf(n){var t,e,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new ta(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Af(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Eu(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Zp(n,t){Vf(n=L(n,$));let e=gt(n);if(e._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Kt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Gr;return Pf(e,i,new As(i,r.cacheSizeBytes,t?.forceOwnership))}function t_(n){Vf(n=L(n,$));let t=gt(n);if(t._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Kt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings(),r=new Gr;return Pf(t,r,new wu(r,e.cacheSizeBytes))}function Pf(n,t,e){let r=new rt;return n.asyncQueue.enqueue(()=>p(this,null,function*(){try{yield Li(n,e),yield Au(n,t),r.resolve()}catch(i){let s=i;if(!wf(s))throw s;Kt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function e_(n){if(n._initialized&&!n._terminated)throw new y(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new rt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{yield function(r){return p(this,null,function*(){if(!de.D())return Promise.resolve();let i=r+"main";yield de.delete(i)})}(Ju(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function n_(n){return function(e){let r=new rt;return e.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return sp(yield lc(e),r)})),r.promise}(gt(n=L(n,$)))}function r_(n){return yp(gt(n=L(n,$)))}function i_(n){return wp(gt(n=L(n,$)))}function s_(n,t){let e=gt(n=L(n,$)),r=new Pu;return Ep(e,n._databaseId,t,r),r}function o_(n,t){return Ap(gt(n=L(n,$)),t).then(e=>e?new mt(n,null,e.query):null)}function Vf(n){if(n._initialized||n._terminated)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Mn=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(lt.fromBase64String(t))}catch(e){throw new y(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(lt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var ve=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new y(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ot(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var ee=class{constructor(t){this._methodName=t}};var Kr=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new y(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new y(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return D(this._lat,t._lat)||D(this._long,t._long)}};var xp=/^__.*__$/,Vu=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Nt(t,this.data,this.fieldMask,e,this.fieldTransforms):new _e(t,this.data,e,this.fieldTransforms)}},Rs=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Nt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function xf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var Ps=class n{constructor(t,e,r,i,s,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:r,yu:!1});return i.wu(t),i}Su(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(t){return this.gu({path:void 0,yu:!0})}Du(t){return Vs(t,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}mu(){if(this.path)for(let t=0;t<this.path.length;t++)this.wu(this.path.get(t))}wu(t){if(t.length===0)throw this.Du("Document fields must not be empty");if(xf(this.fu)&&xp.test(t))throw this.Du('Document fields cannot begin and end with "__"')}},xu=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Yr(t)}Fu(t,e,r,i=!1){return new Ps({fu:t,methodName:e,vu:r,path:ot.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Je(n){let t=n._freezeSettings(),e=Yr(n._databaseId);return new xu(n._databaseId,!!t.ignoreUndefinedProperties,e)}function qs(n,t,e,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,t,e,i);mc("Data must be an object, but it was:",o,r);let a=Cf(r,o),u,c;if(s.merge)u=new Rt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=ku(t,h,e);if(!o.contains(d))throw new y(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);kf(l,d)||l.push(d)}u=new Rt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Vu(new wt(a),u,c)}var jr=class n extends ee{_toFieldTransform(t){if(t.fu!==2)throw t.fu===1?t.Du(`${this._methodName}() can only appear at the top level of your update data`):t.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function Df(n,t,e){return new Ps({fu:3,vu:t.settings.vu,methodName:n._methodName,yu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Du=class n extends ee{_toFieldTransform(t){return new Ge(t.path,new ge)}isEqual(t){return t instanceof n}},bu=class n extends ee{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Df(this,t,!0),r=this.Mu.map(s=>Ye(s,e)),i=new Zt(r);return new Ge(t.path,i)}isEqual(t){return t instanceof n&&js(this.Mu,t.Mu)}},Cu=class n extends ee{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Df(this,t,!0),r=this.Mu.map(s=>Ye(s,e)),i=new te(r);return new Ge(t.path,i)}isEqual(t){return t instanceof n&&js(this.Mu,t.Mu)}},Nu=class n extends ee{constructor(t,e){super(t),this.xu=e}_toFieldTransform(t){let e=new pe(t.serializer,Sd(t.serializer,this.xu));return new Ge(t.path,e)}isEqual(t){return t instanceof n&&this.xu===t.xu}};function dc(n,t,e,r){let i=n.Fu(1,t,e);mc("Data must be an object, but it was:",i,r);let s=[],o=wt.empty();He(r,(u,c)=>{let l=gc(t,u,e);c=st(c);let h=i.Su(l);if(c instanceof jr)s.push(l);else{let d=Ye(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new Rt(s);return new Rs(o,a,i.fieldTransforms)}function fc(n,t,e,r,i,s){let o=n.Fu(1,t,e),a=[ku(t,r,e)],u=[i];if(s.length%2!=0)throw new y(g.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(ku(t,s[d])),u.push(s[d+1]);let c=[],l=wt.empty();for(let d=a.length-1;d>=0;--d)if(!kf(c,a[d])){let m=a[d],A=u[d];A=st(A);let w=o.Su(m);if(A instanceof jr)c.push(m);else{let v=Ye(A,w);v!=null&&(c.push(m),l.set(m,v))}}let h=new Rt(c);return new Rs(l,h,o.fieldTransforms)}function bf(n,t,e,r=!1){return Ye(e,n.Fu(r?4:3,t))}function Ye(n,t){if(Nf(n=st(n)))return mc("Unsupported field value:",t,n),Cf(n,t);if(n instanceof ee)return function(r,i){if(!xf(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.yu&&t.fu!==4)throw t.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=Ye(a,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,t)}return function(r,i){if((r=st(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Sd(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Y.fromDate(r);return{timestampValue:Rn(i.serializer,s)}}if(r instanceof Y){let s=new Y(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Rn(i.serializer,s)}}if(r instanceof Kr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Mn)return{bytesValue:Fd(i.serializer,r._byteString)};if(r instanceof Z){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Qu(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Os(r)}`)}(n,t)}function Cf(n,t){let e={};return ud(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):He(n,(r,i)=>{let s=Ye(i,t.pu(r));s!=null&&(e[r]=s)}),{mapValue:{fields:e}}}function Nf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Y||n instanceof Kr||n instanceof Mn||n instanceof Z||n instanceof ee)}function mc(n,t,e){if(!Nf(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let r=Os(e);throw r==="an object"?t.Du(n+" a custom object"):t.Du(n+" "+r)}}function ku(n,t,e){if((t=st(t))instanceof ve)return t._internalPath;if(typeof t=="string")return gc(n,t);throw Vs("Field path arguments must be of type string or ",n,!1,void 0,e)}var Dp=new RegExp("[~\\*/\\[\\]]");function gc(n,t,e){if(t.search(Dp)>=0)throw Vs(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new ve(...t.split("."))._internalPath}catch{throw Vs(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Vs(n,t,e,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(g.INVALID_ARGUMENT,a+n+u)}function kf(n,t){return n.some(e=>e.isEqual(t))}var Qe=class{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Z(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Fu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Us("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Fu=class extends Qe{data(){return super.data()}};function Us(n,t){return typeof t=="string"?gc(n,t):t instanceof ve?t._internalPath:t._delegate._internalPath}function Ff(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var $r=class{},We=class extends $r{};function a_(n,t,...e){let r=[];t instanceof $r&&r.push(t),r=r.concat(e),function(s){let o=s.filter(u=>u instanceof Mu).length,a=s.filter(u=>u instanceof xs).length;if(o>1||o>0&&a>0)throw new y(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var xs=class n extends We{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return Lf(t._query,e),new mt(t.firestore,t.converter,fa(t._query,e))}_parse(t){let e=Je(t.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){Hh(h,l);let m=[];for(let A of h)m.push(Wh(u,s,A));d={arrayValue:{values:m}}}else d=Wh(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Hh(h,l),d=bf(a,o,h,l==="in"||l==="not-in");return k.create(c,l,d)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function u_(n,t,e){let r=t,i=Us("where",n);return xs._create(i,r,e)}var Mu=class n extends $r{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:U.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)Lf(o,u),o=fa(o,u)}(t._query,e),new mt(t.firestore,t.converter,fa(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Lu=class n extends We{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(i,s,o){if(i.startAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Be(s,o)}(t._query,this._field,this._direction);return new mt(t.firestore,t.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ct(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function c_(n,t="asc"){let e=t,r=Us("orderBy",n);return Lu._create(r,e)}var Ds=class n extends We{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new mt(t.firestore,t.converter,Hi(t._query,this._limit,this._limitType))}};function l_(n){return Sf("limit",n),Ds._create("limit",n,"F")}function h_(n){return Sf("limitToLast",n),Ds._create("limitToLast",n,"L")}var bs=class n extends We{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Mf(t,this.type,this._docOrFields,this._inclusive);return new mt(t.firestore,t.converter,function(i,s){return new Ct(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function d_(...n){return bs._create("startAt",n,!0)}function f_(...n){return bs._create("startAfter",n,!1)}var Cs=class n extends We{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Mf(t,this.type,this._docOrFields,this._inclusive);return new mt(t.firestore,t.converter,function(i,s){return new Ct(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function m_(...n){return Cs._create("endBefore",n,!1)}function g_(...n){return Cs._create("endAt",n,!0)}function Mf(n,t,e,r){if(e[0]=st(e[0]),e[0]instanceof Qe)return function(s,o,a,u,c){if(!u)throw new y(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of pn(s))if(h.field.isKeyField())l.push(Ue(o,u.key));else{let d=u.data.field(h.field);if(ks(d))throw new y(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let m=h.field.canonicalString();throw new y(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}l.push(d)}return new $t(l,c)}(n._query,n.firestore._databaseId,t,e[0]._document,r);{let i=Je(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let m=[];for(let A=0;A<l.length;A++){let w=l[A];if(d[A].field.isKeyField()){if(typeof w!="string")throw new y(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!ju(o)&&w.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let v=o.path.child(M.fromString(w));if(!E.isDocumentKey(v))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${v}' is not because it contains an odd number of segments.`);let x=new E(v);m.push(Ue(a,x))}else{let v=bf(u,c,w);m.push(v)}}return new $t(m,h)}(n._query,n.firestore._databaseId,i,t,e,r)}}function Wh(n,t,e){if(typeof(e=st(e))=="string"){if(e==="")throw new y(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ju(t)&&e.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(M.fromString(e));if(!E.isDocumentKey(r))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ue(n,new E(r))}if(e instanceof Z)return Ue(n,e._key);throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Os(e)}.`)}function Hh(n,t){if(!Array.isArray(n)||n.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Lf(n,t){let e=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Ns=class{convertValue(t,e="none"){switch(qe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return W(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(fe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return He(t,(i,s)=>{r[i]=this.convertValue(s,e)}),r}convertGeoPoint(t){return new Kr(W(t.latitude),W(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Gu(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Pr(t));default:return null}}convertTimestamp(t){let e=Xt(t);return new Y(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=M.fromString(t);R($d(r));let i=new In(r.get(1),r.get(3)),s=new E(r.popFirst(5));return i.isEqual(e)||J(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Bs(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var Ou=class extends Ns{constructor(t){super(),this.firestore=t}convertBytes(t){return new Mn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Z(this.firestore,null,e)}};var Yt=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Ie=class extends Qe{constructor(t,e,r,i,s,o){super(t,e,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new yn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(Us("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},yn=class extends Ie{data(t={}){return super.data(t)}},Te=class{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Yt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new yn(this._firestore,this._userDataWriter,r.key,r,new Yt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new y(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new yn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Yt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new yn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Yt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:bp(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function bp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function p_(n,t){return n instanceof Ie&&t instanceof Ie?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Te&&t instanceof Te&&n._firestore===t._firestore&&Vp(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function __(n){n=L(n,Z);let t=L(n.firestore,$);return Tf(gt(t),n._key).then(e=>pc(t,n,e))}var ne=class extends Ns{constructor(t){super(),this.firestore=t}convertBytes(t){return new Mn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Z(this.firestore,null,e)}};function y_(n){n=L(n,Z);let t=L(n.firestore,$),e=gt(t),r=new ne(t);return vp(e,n._key).then(i=>new Ie(t,r,n._key,i,new Yt(i!==null&&i.hasLocalMutations,!0),n.converter))}function w_(n){n=L(n,Z);let t=L(n.firestore,$);return Tf(gt(t),n._key,{source:"server"}).then(e=>pc(t,n,e))}function v_(n){n=L(n,mt);let t=L(n.firestore,$),e=gt(t),r=new ne(t);return Ff(n._query),Ef(e,n._query).then(i=>new Te(t,r,n,i))}function I_(n){n=L(n,mt);let t=L(n.firestore,$),e=gt(t),r=new ne(t);return Ip(e,n._query).then(i=>new Te(t,r,n,i))}function T_(n){n=L(n,mt);let t=L(n.firestore,$),e=gt(t),r=new ne(t);return Ef(e,n._query,{source:"server"}).then(i=>new Te(t,r,n,i))}function E_(n,t,e){n=L(n,Z);let r=L(n.firestore,$),i=Bs(n.converter,t,e);return zs(r,[qs(Je(r),"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,H.none())])}function A_(n,t,e,...r){n=L(n,Z);let i=L(n.firestore,$),s=Je(i),o;return o=typeof(t=st(t))=="string"||t instanceof ve?fc(s,"updateDoc",n._key,t,e,r):dc(s,"updateDoc",n._key,t),zs(i,[o.toMutation(n._key,H.exists(!0))])}function S_(n){return zs(L(n.firestore,$),[new ye(n._key,H.none())])}function R_(n,t){let e=L(n.firestore,$),r=Pp(n),i=Bs(n.converter,t);return zs(e,[qs(Je(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,H.exists(!1))]).then(()=>r)}function P_(n,...t){var e,r,i;n=st(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||Ru(t[o])||(s=t[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ru(t[o])){let h=t[o];t[o]=(e=h.next)===null||e===void 0?void 0:e.bind(h),t[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),t[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof Z)c=L(n.firestore,$),l=On(n._key.path),u={next:h=>{t[o]&&t[o](pc(c,n,h))},error:t[o+1],complete:t[o+2]};else{let h=L(n,mt);c=L(h.firestore,$),l=h._query;let d=new ne(c);u={next:m=>{t[o]&&t[o](new Te(c,d,h,m))},error:t[o+1],complete:t[o+2]},Ff(n._query)}return function(d,m,A,w){let v=new kn(w),x=new Br(m,v,A);return d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return tc(yield Fn(d),x)})),()=>{v.$a(),d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return ec(yield Fn(d),x)}))}}(gt(c),l,a,u)}function V_(n,t){return Tp(gt(n=L(n,$)),Ru(t)?t:{next:t})}function zs(n,t){return function(r,i){let s=new rt;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return ep(yield lc(r),i,s)})),s.promise}(gt(n),t)}function pc(n,t,e){let r=e.docs.get(t._key),i=new ne(n);return new Ie(n,i,t._key,r,new Yt(e.hasPendingWrites,e.fromCache),t.converter)}var Cp={maxAttempts:5};var Jh=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Je(t)}set(t,e,r){this._verifyNotCommitted();let i=ce(t,this._firestore),s=Bs(i.converter,e,r),o=qs(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,H.none())),this}update(t,e,r,...i){this._verifyNotCommitted();let s=ce(t,this._firestore),o;return o=typeof(e=st(e))=="string"||e instanceof ve?fc(this._dataReader,"WriteBatch.update",s._key,e,r,i):dc(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,H.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=ce(t,this._firestore);return this._mutations=this._mutations.concat(new ye(e._key,H.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ce(n,t){if((n=st(n)).firestore!==t)throw new y(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var qu=class extends class{constructor(e,r){this._firestore=e,this._transaction=r,this._dataReader=Je(e)}get(e){let r=ce(e,this._firestore),i=new Ou(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new Qe(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Qe(this._firestore,i,r._key,null,r.converter);throw S()})}set(e,r,i){let s=ce(e,this._firestore),o=Bs(s.converter,r,i),a=qs(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(e,r,i,...s){let o=ce(e,this._firestore),a;return a=typeof(r=st(r))=="string"||r instanceof ve?fc(this._dataReader,"Transaction.update",o._key,r,i,s):dc(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(e){let r=ce(e,this._firestore);return this._transaction.delete(r._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=ce(t,this._firestore),r=new ne(this._firestore);return super.get(t).then(i=>new Ie(this._firestore,r,e._key,i._document,new Yt(!1,!1),e.converter))}};function D_(n,t,e){n=L(n,$);let r=Object.assign(Object.assign({},Cp),e);return function(s){if(s.maxAttempts<1)throw new y(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new rt;return s.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let c=yield _p(s);new Tu(s.asyncQueue,c,a,o,u).Xa()})),u.promise}(gt(n),i=>t(new qu(n,i)),r)}function b_(){return new jr("deleteField")}function C_(){return new Du("serverTimestamp")}function N_(...n){return new bu("arrayUnion",n)}function k_(...n){return new Cu("arrayRemove",n)}function F_(n){return new Nu("increment",n)}(function(t,e=!0){(function(i){Ln=i})(Rc),Ac(new Tc("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new $(new Ko(r.getProvider("auth-internal")),new Wo(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new y(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new In(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),$s(Jl,"4.6.1",t),$s(Jl,"4.6.1","esm2017")})();export{zp as a,Kt as b,Gp as c,y as d,Y as e,ot as f,E as g,jp as h,In as i,Sp as j,L as k,Rp as l,Z as m,Wp as n,Hp as o,Pp as p,Jp as q,Vp as r,Yp as s,Xp as t,gt as u,Zp as v,t_ as w,e_ as x,n_ as y,r_ as z,i_ as A,s_ as B,o_ as C,Mn as D,ve as E,Kr as F,a_ as G,u_ as H,c_ as I,l_ as J,h_ as K,d_ as L,f_ as M,m_ as N,g_ as O,Ns as P,Ie as Q,yn as R,Te as S,p_ as T,__ as U,y_ as V,w_ as W,v_ as X,I_ as Y,T_ as Z,E_ as _,A_ as $,S_ as aa,R_ as ba,P_ as ca,V_ as da,zs as ea,Jh as fa,D_ as ga,b_ as ha,C_ as ia,N_ as ja,k_ as ka,F_ as la};
